<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Douleur abdo 4 - Grille ECOS</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .header { background: #2c5aa0; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 8px 8px 0 0; }
        .section { margin-bottom: 30px; border: 2px solid #ddd; border-radius: 8px; overflow: hidden; background-color: #ffffff; }
        .section-header { background: #f8f9fa; padding: 15px; font-weight: bold; font-size: 18px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .section-content { padding: 15px; background-color: #ffffff; }
        .header-row { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px; gap: 10px; padding: 10px 0; border-bottom: 2px solid #ddd; font-weight: bold; text-align: center; color: #333333; }
        .header-row.communication-header { grid-template-columns: 2fr 80px 80px 80px 80px 80px; }
        .header-row div:first-child { text-align: left; }
        .criteria-row { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px; gap: 10px; align-items: start; padding: 15px 0 15px 5px; border-bottom: 1px solid #eeeeee; }
        .criteria-row:last-child { border-bottom: none; }
        .criteria-text { font-weight: 500; }
        .sub-criteria { font-size: 0.9em; color: #333; margin-top: 5px; padding-left: 18px; line-height: 1.2; }
        .details-with-checkboxes { margin-top: 8px; }
        .detail-row { display: grid; grid-template-columns: 1fr 100px; align-items: center; padding: 2px 0 2px 18px; gap: 10px; line-height: 1.1; }
        .detail-text { font-size: 0.9em; color: #333; }
        .patient-response-highlight { color: rgb(44, 90, 160) !important; }
        .detail-text .patient-response-highlight { color: rgb(44, 90, 160) !important; }
        .criteria-detail .patient-response-highlight { color: rgb(44, 90, 160) !important; }
        .detail-checkboxes { text-align: center; }
        .detail-checkbox input[type="checkbox"] { cursor: pointer; transform: scale(1.1); }
        .patient-response { font-size: 0.9em; color: rgb(44, 90, 160); font-weight: 500; }
        .exemples-phrases { margin-top: 8px; padding-left: 20px; }
        .exemple-phrase { font-size: 0.9em; color: rgba(112, 188, 123, 0.95); font-style: italic; line-height: 1.4; margin: 3px 0; }
        .checkbox-group { text-align: center; }
        .points-display { text-align: center; font-weight: bold; color: #2c5aa0; font-size: 18px; }
        .scoring-rule { font-size: 0.85em; color: #888; font-style: italic; margin-top: 8px; padding-left: 20px; }
        .criteria-subheader { background: #fffbe6; padding: 10px 15px; margin: 10px 0 5px 0; border-left: 4px solid #faad14; font-weight: bold; color: #8b6914; }
        input[type="radio"] { cursor: pointer; transform: scale(1.2); }
        input[type="radio"]:disabled { opacity: 0.3; cursor: not-allowed; }
        .score { font-weight: bold; color: hsl(216, 57%, 40%); font-size: 18px; }
        .total-sections { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .total-section { display: flex; flex-direction: column; justify-content: space-between; text-align: center; background: #f0f8ff; border: 1px solid #ddd; border-radius: 8px; transition: all 0.3s; }
        .total-label { background: #f8f9fa; padding: 5px; font-weight: bold; font-size: 20px; border-bottom: 1px solid #ddd; }
        .total-body { flex: 1; display: flex; align-items: center; justify-content: center; padding: 5px; }
        .total-pourcent-body { flex: 1; padding: 10px; }
        .total-score, .total-note-globale { font-size: 56px; font-weight: bold; line-height: 1; }
        .total-pourcent-sections { display: flex; flex-wrap: nowrap; gap: 10px; height: 100%; align-items: stretch; }
        .total-pourcent-section { flex: 1 1 auto; min-width: 0; display: flex; flex-direction: column; text-align: center; background: #416caa; padding: 10px; border-radius: 5px; transition: all 0.3s; border: none; }
        .total-pourcent-section:last-child { border-right: none; }
        .total-section-label { color: #eeeeee; font-size: 14px; font-weight: normal; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pourcent-body { flex: 1; display: flex; align-items: center; justify-content: center; }
        .total-pourcent-value { font-weight: bold; font-size: 28px; line-height: 1; color: white; transition: all 0.3s; }
        .note-a { background-color: #e6f4ea; color: #2c974b; }
        .note-a.total-pourcent-section { background-color: #2c974b; }
        .note-b { background-color: #e9f3fd; color: #4e9cf0; }
        .note-b.total-pourcent-section { background-color: #4e9cf0; }
        .note-c { background-color: #fdf5e6; color: #f0ad4e; }
        .note-c.total-pourcent-section { background-color: #f0ad4e; }
        .note-d { background-color: #fceee3; color: #e67e22; }
        .note-d.total-pourcent-section { background-color: #e67e22; }
        .note-e { background-color: #fbeaea; color: #d9534f; }
        .note-e.total-pourcent-section { background-color: #d9534f; }
        .note-neutral { background-color: #f0f8ff; color: #2c5aa0; }
        .note-neutral.total-pourcent-section { background-color: #6B8BC3; }
        .note-a.total-pourcent-body { background-color: #e6f4ea; }
        .note-b.total-pourcent-body { background-color: #e9f3fd; }
        .note-c.total-pourcent-body { background-color: #fdf5e6; }
        .note-d.total-pourcent-body { background-color: #fceee3; }
        .note-e.total-pourcent-body { background-color: #fbeaea; }
        .note-neutral.total-pourcent-body { background-color: #f0f8ff; }
        /* Styles pour les sections avec coloration selon le score */
        .section.note-a { border-color: #2c974b; }
        .section.note-a .section-header { background-color: #e6f4ea; color: #2c974b; }
        .section.note-b { border-color: #4e9cf0; }
        .section.note-b .section-header { background-color: #e9f3fd; color: #4e9cf0; }
        .section.note-c { border-color: #f0ad4e; }
        .section.note-c .section-header { background-color: #fdf5e6; color: #f0ad4e; }
        .section.note-d { border-color: #e67e22; }
        .section.note-d .section-header { background-color: #fceee3; color: #e67e22; }
        .section.note-e { border-color: #d9534f; }
        .section.note-e .section-header { background-color: #fbeaea; color: #d9534f; }
        .section.note-neutral { border-color: #ddd; }
        .section.note-neutral .section-header { background-color: #f8f9fa; color: #333333; }
        /* Styles pour les critères individuels */
        .criteria-row.score-2 { background-color: rgba(44, 151, 75, 0.1); }
        .criteria-row.score-2 .criteria-text { color: #2c974b; }
        .criteria-row.score-max { background-color: rgba(44, 151, 75, 0.1); }
        .criteria-row.score-max .criteria-text { color: #2c974b; }
        .criteria-row.score-1 { background-color: rgba(240, 173, 78, 0.1); }
        .criteria-row.score-1 .criteria-text { color: #f0ad4e; }
        .criteria-row.score-0 { background-color: rgba(217, 83, 79, 0.1); }
        .criteria-row.score-0 .criteria-text { color: #d9534f; }
        .criteria-row:not(.score-0):not(.score-1):not(.score-2):not(.score-max) .criteria-text { color: #000; }
        /* Styles supplémentaires pour les scores plus élevés */
        .criteria-row.score-3 { background-color: rgba(44, 151, 75, 0.1); }
        .criteria-row.score-3 .criteria-text { color: #2c974b; }
        .criteria-row.score-4 { background-color: rgba(44, 151, 75, 0.1); }
        .criteria-row.score-4 .criteria-text { color: #2c974b; }
        .criteria-row.score-5 { background-color: rgba(44, 151, 75, 0.1); }
        .criteria-row.score-5 .criteria-text { color: #2c974b; }
        .communication-section.score-a { background-color: rgba(44, 151, 75, 0.1); }
        .communication-section.score-a .communication-text { color: #2c974b; }
        .communication-section.score-b { background-color: rgba(78, 156, 240, 0.1); }
        .communication-section.score-b .communication-text { color: #4e9cf0; }
        .communication-section.score-c { background-color: rgba(240, 173, 78, 0.1); }
        .communication-section.score-c .communication-text { color: #f0ad4e; }
        .communication-section.score-d { background-color: rgba(230, 126, 34, 0.1); }
        .communication-section.score-d .communication-text { color: #e67e22; }
        .communication-section.score-e { background-color: rgba(217, 83, 79, 0.1); }
        .communication-section.score-e .communication-text { color: #d9534f; }
        .grade-scale { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .grade-scale h3 { margin-top: 0; }
        .grade-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .missing-items { display: none !important; }
        .missing-items h3 { margin-top: 0; }
        .missing-item { color: #dc3545; font-weight: bold; }
        .redflags-main-section { margin-top: 30px; padding: 20px; background: #fff5f5; border-radius: 8px; border: 1px solid #f5c6cb; }
        .redflags-main-section h3 { margin-top: 0; border-bottom: 2px solid #f5c6cb; padding-bottom: 10px; }
        .redflags-category-section { margin: 15px 0; padding: 10px; background: white; border-radius: 5px; border-left: 4px solid #dc3545; }
        .annexes { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd; }
        .annexes h3 { margin-top: 0; color: #2c5aa0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .annexes-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        .annexe-item { padding: 15px; background: white; border-radius: 5px; border: 1px solid #e0e0e0; }
        .annexe-title { font-weight: bold; color: #2c5aa0; margin-bottom: 8px; font-size: 16px; }
        .annexe-description { color: #666; font-style: italic; margin-bottom: 10px; font-size: 14px; }
        .annexe-image { text-align: center; margin: 10px 0; }
        .annexe-image img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .annexe-document { background: #f0f8ff; padding: 10px; border-radius: 4px; border-left: 4px solid #2c5aa0; white-space: pre-wrap; font-family: "Courier New", monospace; font-size: 13px; }
        
        /* Styles pour le scénario de la patiente standardisée */
        .annexe-scenario { grid-column: 1 / -1; max-width: none; }
        .annexe-scenario-content { padding: 15px; background: #fafafa; border-radius: 4px; }
        .scenario-info { background: #e8f4f8; padding: 10px 15px; border-radius: 4px; margin-bottom: 15px; font-size: 15px; }
        .scenario-section { margin-bottom: 20px; }
        .scenario-subsection { margin-bottom: 15px; }
        .scenario-subsection strong { color: #2c5aa0; }
        .scenario-section h4 { color: #2c5aa0; margin: 15px 0 10px 0; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .scenario-section ul { margin: 10px 0; padding-left: 25px; }
        .scenario-section li { margin: 5px 0; line-height: 1.5; }
        .scenario-subsection { margin: 10px 0 15px 0; }
        .scenario-subsection strong { color: #555; }
        .scenario-subsection ul { margin-top: 5px; }
        
        /* Styles pour les interventions de l'expert */
        .annexe-interventions { grid-column: 1 / -1; max-width: none; }
        .annexe-interventions-content { padding: 15px; }
        .intervention-item { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 12px; margin-bottom: 12px; }
        .intervention-header { font-size: 15px; margin-bottom: 8px; color: #856404; }
        .intervention-moment { font-weight: normal; font-style: italic; color: #666; }
        .intervention-instruction { margin: 8px 0; color: #333; }
        .intervention-message { background: #fff; padding: 8px 12px; border-left: 3px solid #ffc107; font-style: italic; color: #721c24; margin-top: 8px; }
        
        /* Styles pour les informations de l'expert */
        .annexe-informations-expert { grid-column: 1 / -1; max-width: none; }
        .annexe-informations-content { padding: 15px; background: #f5f5f5; border-radius: 4px; }
        .info-section { margin-bottom: 20px; }
        .info-section:last-child { margin-bottom: 0; }
        .info-section h4 { color: #2c5aa0; margin: 0 0 10px 0; font-size: 16px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .info-section h5 { color: #4a7ba7; margin: 15px 0 8px 0; font-size: 14px; font-weight: 600; }
        .info-section p { margin: 10px 0; line-height: 1.6; }
        .info-section ul { margin: 10px 0; padding-left: 25px; }
        .info-section li { margin: 5px 0; line-height: 1.5; }
        
        /* Styles pour les diagnostics différentiels dans annexes */
        .annexe-dd-section { grid-column: 1 / -1; max-width: none; }
        .annexe-dd-content { padding: 15px; background: #fff5f0; border-radius: 4px; }
        .dd-category { margin-bottom: 20px; }
        .dd-category:last-child { margin-bottom: 0; }
        .dd-category h4 { color: #a92117; margin: 0 0 15px 0; font-size: 16px; border-bottom: 1px solid #e0d0c8; padding-bottom: 5px; }
        .dd-items { display: flex; flex-direction: column; gap: 15px; }
        .dd-item { background: white; border: 1px solid #e5e5e5; border-radius: 4px; padding: 12px; }
        .dd-item-header { margin-bottom: 8px; }
        .dd-diagnosis { color: #a92117; font-weight: 600; font-size: 15px; }
        .dd-cause { margin-bottom: 8px; line-height: 1.5; font-size: 14px; }
        .dd-test { font-size: 14px; margin-top: 5px; }
        
        /* Styles pour la théorie pratique */
        .annexe-theorie-pratique { grid-column: 1 / -1; max-width: none; }
        .annexe-theorie-content { padding: 15px; background: #f0f5ff; border-radius: 4px; }
        .theorie-text { line-height: 1.6; color: #333; }
        .theorie-section { margin-bottom: 20px; }
        .theorie-section:last-child { margin-bottom: 0; }
        .theorie-section h4 { color: #1a4b84; margin: 0 0 10px 0; font-size: 16px; }
        .theorie-section p { margin: 10px 0; line-height: 1.6; }
        .theorie-section ul { margin: 10px 0; padding-left: 25px; }
        .theorie-section li { margin: 5px 0; line-height: 1.5; }
        /* Styles pour rappels thérapeutiques et examens complémentaires */
        .annexe-rappels-therapeutiques, .annexe-examens-complementaires { grid-column: 1 / -1; max-width: none; }
        .rappels-list, .examens-list { margin: 0; padding-left: 25px; }
        .rappels-list li, .examens-list li { margin: 8px 0; line-height: 1.6; color: #333; }
        .annexe-rappels-therapeutiques .annexe-title { color: #998800; }
        .annexe-examens-complementaires .annexe-title { color: #346929; }
        .communication-section { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px 80px; gap: 10px; align-items: start; padding: 15px 0 15px 5px; border-bottom: 1px solid #eee; }
        .communication-text { font-weight: 500; }
        .communication-desc { font-size: 0.85em; color: #666; margin-top: 5px; font-style: italic; }
        /* Section Clôture */
        .cloture-section { margin-bottom: 20px; }
        .cloture-section .section-header { background-color: #f0f4f8; }
        .cloture-item { margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px; }
        .cloture-title { color: #2c5aa0; margin: 0 0 10px 0; font-size: 16px; font-weight: bold; }
        .cloture-content { color: #333; line-height: 1.6; font-style: italic; }
        .cloture-content-green { color: rgb(112, 188, 123); font-weight: 500; }
        .communication-desc-detail { font-size: 0.8em; color: #666; margin-left: 20px; font-style: normal; }
        .vital-signs { margin-top: 10px; margin-bottom: 0px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; font-size: 0.9em; }
        .vital-sign { text-align: center; background: #416caa; padding: 10px; border-radius: 5px; }
        .vital-sign-label { color: #eeeeee; }
        .vital-sign-value { color: rgb(255, 255, 255); margin-top: 2px; }
        .dd-section { background: #f0f8ff; padding: 15px; margin: 0 0 10px 0; border-radius: 5px; }
        .dd-title { font-weight: bold; margin-bottom: 10px; color: #2c5aa0; }
        .dd-category { margin: 10px 0; font-weight: bold; color: #2c5aa0; }
        .dd-item { margin-left: 20px; margin-top: 5px; font-weight: bold; color: rgb(169, 34, 23); }
        .dd-test { color: #666; font-style: italic; margin-left: 10px; }
        .therapy-section { background: rgba(255, 250, 230, 0.4); padding: 10px 10px 0 20px; margin: 0; border-radius: 5px; color: #000; }
        .therapy-title { font-weight: bold; margin-bottom: 5px; color: #998800; }
        .redflags-section { background: #fff5f5; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .redflags-title { font-weight: bold; margin-bottom: 8px; color: #dc3545; }
        .redflags-item { margin-bottom: 6px; padding-left: 22px; }
        .redflags-text { color: #dc3545; font-weight: 500; }
        .redflags-description { color: #666; font-size: 0.9em; margin-top: 2px; margin-left: 20px; }
        .annexes { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd; }
        .annexes h3 { margin-top: 0; color: #2c5aa0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .annexes-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        .annexe-item { padding: 15px; background: white; border-radius: 5px; border: 1px solid #e0e0e0; }
        .annexe-title { font-weight: bold; color: #2c5aa0; margin-bottom: 8px; font-size: 16px; }
        .annexe-description { color: #666; font-style: italic; margin-bottom: 10px; font-size: 14px; }
        .annexe-image { text-align: center; margin: 10px 0; }
        .annexe-image img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .annexe-document { background: #f0f8ff; padding: 10px; border-radius: 4px; border-left: 4px solid #2c5aa0; white-space: pre-wrap; font-family: "Courier New", monospace; font-size: 13px; }
        
        /* MINUTEUR */
        .timer-container {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.75);
            border: 3px solid #2c5aa0;
            border-radius: 15px;
            padding: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
            min-width: 200px;
        }
        .timer-display {
            font-size: 40px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .timer-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 14px;
        }
        .start-btn {
            background: #28a745;
            color: white;
        }
        .start-btn:hover {
            background: #218838;
        }
        .stop-btn {
            background: #dc3545;
            color: white;
        }
        .stop-btn:hover {
            background: #c82333;
        }
        .reset-btn {
            background: #6c757d;
            color: white;
        }
        .reset-btn:hover {
            background: #5a6268;
        }
        .timer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .timer-btn:disabled:hover {
            background: #6c757d;
        }
        .timer-status {
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .status-running {
            background: #e3f2fd;
            color: #1976d2;
        }
        .status-warning {
            background: #fff3cd;
            color: #ff6f00;
        }
        .status-finished {
            background: #f8d7da;
            color: #721c24;
        }
        .timer-warning {
            animation: pulse-warning 2s infinite;
        }
        .timer-critical {
            animation: pulse-critical 1s infinite;
        }
        @keyframes pulse-warning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes pulse-critical {
            0%, 100% { transform: scale(1); border-color: #dc3545; }
            50% { transform: scale(1.1); border-color: #ff0000; }
        }
        
        /* COLORATION POST-MINUTEUR */
        .criteria-zero-points {
            background-color: rgba(251, 234, 234, 0.6) !important;
        }
        .criteria-one-point {
            background-color: rgba(253, 245, 230, 0.6) !important;
        }
        .criteria-full-points {
            background-color: rgba(230, 244, 234, 0.6) !important;
        }
        .criteria-not-answered {
            background-color: rgba(240, 248, 255, 0.6) !important;
        }
        
        /* COLORATION COMMUNICATION */
        .communication-note-a {
            background-color: rgba(230, 244, 234, 0.6) !important;
        }
        .communication-note-b {
            background-color: rgba(233, 243, 253, 0.6) !important;
        }
        .communication-note-c {
            background-color: rgba(253, 245, 230, 0.6) !important;
        }
        .communication-note-d {
            background-color: rgba(252, 238, 227, 0.6) !important;
        }
        .communication-note-e {
            background-color: rgba(251, 234, 234, 0.6) !important;
        }
        .communication-not-answered {
            background-color: rgba(240, 248, 255, 0.6) !important;
        }
        
        /* MODE SELECTOR */
        .mode-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid #2c5aa0;
            border-radius: 30px;
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
            display: flex;
            gap: 5px;
        }
        .mode-button {
            padding: 8px 16px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            background: transparent;
            color: #2c5aa0;
        }
        .mode-button.active {
            background: #2c5aa0;
            color: white;
        }
        .mode-button:hover:not(.active) {
            background: #e8f0fe;
        }
        
        /* Mode-specific hiding and showing - CORRIGÉ */
        .revision-mode .timer-container {
            display: none !important;
        }
        .exam-mode .timer-container {
            display: block !important;
        }
        .exam-mode .revision-controls {
            display: none !important;
        }
        /* Masquer les descriptions et titres d'annexes en mode examen quand le timer est actif */
        .exam-mode.timer-running .annexe-item .annexe-title,
        .exam-mode.timer-running .annexe-item .annexe-description {
            display: none !important;
        }
        
        /* Revision controls */
        .revision-controls {
            position: fixed;
            top: 70px;
            right: 20px;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 30px;
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 5px;
            z-index: 1000;
        }
        .lacune-button {
            background: transparent;
            color: #4CAF50;
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .lacune-button:hover {
            background: #4CAF50;
            color: white;
        }
        .reset-revision-button {
            background: transparent;
            color: #6c757d;
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .reset-revision-button:hover {
            background: #6c757d;
            color: white;
        }
        
        /* Styles pour les commentaires discrets */
        .comment-button { 
            background: none; 
            border: none; 
            color: #2c5aa0; 
            cursor: pointer; 
            font-size: 14px; 
            padding: 2px 6px; 
            margin-left: 8px; 
            border-radius: 3px; 
            opacity: 0.6;
            transition: all 0.2s;
        }
        .comment-button:hover { opacity: 1; background: rgba(44, 90, 160, 0.1); }
        .comment-button.has-content { opacity: 1; color: #d9534f; }
        .criterion-comment-section { 
            display: none; 
            margin: 8px 0 12px 20px; 
            padding: 10px; 
            background: #fafafa; 
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .criterion-comment-section.show { display: block; }
        .section-comment-button {
            background: rgba(44, 90, 160, 0.1);
            border: 1px solid #2c5aa0;
            color: #2c5aa0;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
            margin-left: 10px;
            border-radius: 15px;
            opacity: 0.8;
            transition: all 0.2s;
            font-weight: 500;
        }
        .section-comment-button:hover { 
            opacity: 1; 
            background: rgba(44, 90, 160, 0.2); 
            transform: scale(1.05);
        }
        .section-comment-button.has-content { 
            background: rgba(220, 53, 69, 0.1);
            border-color: #d9534f;
            color: #d9534f; 
        }
        .section-comment-section { 
            display: none;
            margin: 20px 0; 
            padding: 12px; 
            background: #f8f9fa; 
            border-radius: 6px;
        }
        .section-comment-section.show { display: block; }
        .section-comment-section.global { 
            display: block; 
            background: #f0f8ff; 
        }
        /* La section commentaire global reste toujours visible sauf à l'impression */
        .comment-textarea { 
            width: calc(100% - 0px); 
            min-height: 26px; 
            padding: 5px; 
            margin-right: 0px;
            border: 1px solid #ddd; 
            border-radius: 3px; 
            font-family: Arial, sans-serif;
            font-size: 12px; 
            resize: vertical;
            box-sizing: border-box;
            overflow-y: hidden;
            color: #7b3f00;
            height: 26px;
        }
        .section-comment-section .comment-textarea {
            min-height: 28px;
            font-size: 14px;
            height: 28px;
        }
        .section-comment-section.global .comment-textarea {
            min-height: 30px;
            font-size: 16px;
            height: 30px;
        }
        .comment-textarea:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }
        
        /* Masquer les boutons à l'impression */
        @media print {
            .comment-button,
            .section-comment-button {
                display: none !important;
            }
            .criterion-comment-section:not(.has-content),
            .section-comment-section:not(.has-content) {
                display: none !important;
            }
            .criterion-comment-section.has-content,
            .section-comment-section.has-content {
                display: block !important;
                page-break-inside: avoid;
            }
        }
        
        /* Styles pour les lacunes */
        .lacune-rouge {
            background-color: #ffebee !important;
        }
        .lacune-orange {
            background-color: #fff3e0 !important;
        }
        .lacune-verte {
            background-color: #e8f5e8 !important;
        }
        
        /* Bouton d'impression */
        .print-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(44, 90, 160, 0.3);
            z-index: 1000;
        }
        .print-button:hover {
            background: #1e3f70;
        }
        @media print {
            /* Masquer les éléments interactifs */
            .print-button, .mode-selector, .revision-controls, .missing-items { display: none !important; }
            .comment-button, .section-comment-button { display: none !important; }
            /* IMPORTANT: MASQUER LE MINUTEUR à L'IMPRESSION! */
            .timer-container {
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                left: -9999px !important;
            }
            /* Supprimer les bordures gauches à l'impression */
            .criteria-row { border-left: none !important; }
            .communication-section { border-left: none !important; }
            .lacune-rouge { border-left: none !important; }
            .lacune-orange { border-left: none !important; }
            .lacune-verte { border-left: none !important; }
            
            /* Gestion des commentaires à l'impression */
            .criterion-comment-section:not(.has-content),
            .section-comment-section:not(.has-content) { display: none !important; }
            .section-comment-section.global:not(.has-content) { display: none !important; }
            .criterion-comment-section.has-content,
            .section-comment-section.has-content { display: block !important; }
            
            /* Les textareas conservent leur hauteur actuelle à l'impression */
            .comment-textarea {
                border: 1px solid #ccc !important;
                background: white !important;
                padding: 4px !important;
                margin-right: 15px !important;
                resize: none !important;
                font-size: 8pt !important;
                font-family: Arial, sans-serif !important;
                font-style: italic !important;
                color: #333 !important;
                border-radius: 2px !important;
                /* Conserver la hauteur actuelle */
                overflow: hidden !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Sections commentaires */
            .criterion-comment-section {
                page-break-inside: avoid;
                margin: 6px 0 8px 15px !important;
                padding: 6px 8px !important;
                background: #f9f9f9 !important;
                border-left: 2px solid #666 !important;
                border-radius: 0 3px 3px 0 !important;
                box-shadow: none !important;
            }
            
            /* Cacher les sections de commentaires vides */
            .criterion-comment-section:not(.show) {
                display: none !important;
            }
            .criterion-comment-section.show:not(.has-content) {
                display: none !important;
            }
            
            .section-comment-section {
                page-break-inside: avoid;
                margin: 5px 0 10px 0 !important;
                padding: 6px 8px !important;
                background: #f5f5f5 !important;
                border: 1px solid #ccc !important;
                border-radius: 4px !important;
            }
            
            /* Cacher toutes les sections de commentaires vides à l'impression */
            .section-comment-section {
                display: none !important;
            }
            /* Montrer seulement les sections avec contenu */
            .section-comment-section.has-content {
                display: block !important;
            }
            
            /* Configuration de la page */
            @page { size: A4; margin: 10mm 9mm 10mm 10mm; }
            body { margin: 0; background: white !important; font-size: 9pt; }
            
            /* Optimisation du container et des marges */
            .container { 
                max-width: 100%; 
                margin: 0; 
                box-shadow: none; 
                padding: 0; 
                background: white !important;
            }
            
            /* Gestion du header pour qu'il ne soit jamais seul */
            .header { 
                page-break-after: avoid; 
                margin: 0;
                margin-bottom: 10px;
                padding: 10px;
                font-size: 8pt;
            }
            .header h1 { font-size: 14pt; margin: 0 0 5px 0; }
            
            /* Optimisation des signes vitaux */
            .vital-signs { gap: 10px; margin: 5px 0; }
            .vital-sign { padding: 5px; font-size: 8pt; }
            
            /* Forcer l'anamnèse à commencer sur la page 1 */
            .section:first-of-type { page-break-before: avoid !important; }
            .section:first-of-type .section-header { 
                page-break-after: avoid; 
                min-height: 20px;
            }
            .section:first-of-type .criteria-row:first-child { 
                page-break-before: avoid !important; 
            }
            
            /* Les autres sections peuvent se diviser si nécessaire */
            .section { 
                page-break-inside: auto; 
                margin-bottom: 15px;
            }
            .section-header { 
                page-break-after: avoid;
                font-size: 12pt;
                padding: 8px;
            }
            .section-content { padding: 8px; }
            
            /* Optimisation de la grille */
            .header-row { 
                grid-template-columns: 2.5fr 60px 60px 60px 60px; 
                font-size: 8pt;
            }
            .header-row.communication-header { 
                grid-template-columns: 2.5fr 60px 60px 60px 60px 60px; 
                padding: 5px 0;
            }
            .criteria-row { 
                grid-template-columns: 2.5fr 60px 60px 60px 60px; 
                page-break-inside: avoid;
                padding: 8px 0 8px 5px;
            }
            .criteria-text { font-size: 8.5pt; line-height: 1.1 !important; }
            .sub-criteria { font-size: 7.5pt; padding-left: 15px; line-height: 1.1 !important; }
            .detail-row { font-size: 7.5pt; padding: 1px 0 1px 15px; line-height: 1.0; }
            .detail-text { font-size: 7.5pt; line-height: 1.1 !important; }
            .patient-response { font-size: 7.5pt; }
            .points-display { font-size: 14px; }
            
            /* Communication section */
            .communication-section-container {
                page-break-inside: avoid !important;
            }
            
            /* Cloture section */
            .cloture-section {
                page-break-inside: avoid !important;
            }
            .cloture-item {
                page-break-inside: avoid !important;
                margin-bottom: 10px;
                padding: 10px;
            }
            .cloture-title { font-size: 10pt; }
            .cloture-content { font-size: 8.5pt; line-height: 1.2 !important; }
            .communication-section { 
                grid-template-columns: 2.5fr 60px 60px 60px 60px 60px;
                padding: 8px 0;
            }
            .communication-text { font-size: 8.5pt; }
            .communication-desc { font-size: 7pt; }
            
            /* Optimisation des sections spéciales */
            .dd-section { padding: 8px; margin: 0 0 5px 0; font-size: 8pt; }
            .dd-title { font-size: 9pt; }
            .dd-item { font-size: 8pt; margin-left: 15px; }
            
            .therapy-section { 
                padding: 8px; 
                margin: 0; 
                font-size: 8pt;
                background: rgba(255, 250, 230, 0.3) !important;
                color: #000 !important;
            }
            .therapy-title { font-size: 9pt; }
            
            .redflags-section { padding: 8px; margin: 5px 0; }
            .redflags-title { font-size: 9pt; }
            .redflags-text { font-size: 8.5pt; }
            .redflags-description { font-size: 7.5pt; }
            
            /* Optimisation des totaux */
            .total-sections { 
                gap: 6px;
                margin-bottom: 6px;
            }
            .total-label { 
                padding: 4px;
                font-size: 16px;
                border-radius: 8px 8px 0 0;
            }
            .total-body {
                padding: 3px;
                border-radius: 0 0 8px 8px;
            }
            .total-score,
            .total-note-globale {
                font-size: 32px;
            }
            .total-pourcent-body {
                padding: 6px;
                border-radius: 0 0 8px 8px;
            }
            .total-pourcent-sections {
                display: flex;
                flex-wrap: nowrap;
                gap: 4px;
                align-items: stretch;
            }
            .total-pourcent-section {
                flex: 0 0 auto;
                min-width: 60px;
                padding: 6px 8px;
                white-space: nowrap;
            }
            .total-section-label {
                font-size: 11px;
                margin-bottom: 3px;
                white-space: nowrap;
            }
            .total-pourcent-value {
                font-size: 20px;
            }
            .pourcent-body {
                padding: 2px 0;
            }
            
            /* Échelle de notation */
            .grade-scale { 
                padding: 10px; 
                margin-top: 15px;
                page-break-inside: avoid;
            }
            .grade-scale h3 { font-size: 11pt; margin: 0 0 5px 0; }
            .grade-row { padding: 3px 0; font-size: 8pt; }
            
            /* Optimisations pour les annexes à l'impression */
            .annexes { 
                page-break-before: always !important;
                margin-top: 0 !important;
                padding-top: 15px !important;
            }
            
            .annexes-grid { 
                display: grid !important; 
                grid-template-columns: repeat(2, 1fr) !important; 
                gap: 15px !important; 
                margin-top: 15px !important; 
            }
            
            .annexe-item { 
                page-break-inside: avoid !important;
                padding: 15px !important;
                border: 1px solid #ddd !important;
            }
            
            .annexe-title { 
                font-size: 10pt !important;
                margin-bottom: 5px !important;
            }
            
            .annexe-description { 
                font-size: 8pt !important;
                line-height: 1.3 !important;
                margin-bottom: 8px !important;
            }
            
            /* Réduire l'interligne des detail-row */
            .detail-row { 
                line-height: 1.1 !important; 
                padding: 2px 0 2px 15px !important;
            }
            
            /* Réduire et ajuster les checkboxes des détails */
            .detail-checkboxes { 
                text-align: right !important;
                padding-right: 5px !important;
            }
            .detail-checkbox input[type="checkbox"] { 
                transform: scale(0.8) !important;
                margin: 0 !important;
            }
            
            /* Page-break pour DD section et théorie pratique */
            .annexe-dd-section,
            .annexe-theorie-pratique { 
                page-break-before: always !important; 
            }
            
            /* Pas de page-break dans les scenario-section */
            .scenario-section, 
            .scenario-subsection { 
                page-break-inside: avoid !important; 
            }
            
            /* Réduire l'interligne dans toutes les annexes */
            .annexe-scenario-content,
            .annexe-interventions-content,
            .annexe-informations-content,
            .annexe-theorie-content { 
                line-height: 1.15 !important; 
            }
            
            /* Styles spécifiques pour les sections du scénario */
            .scenario-section {
                margin-bottom: 8px !important;
                padding: 4px !important;
            }
            
            .scenario-section h4 {
                font-size: 9.5pt !important;
                margin: 0 0 4px 0 !important;
                line-height: 1.1 !important;
                color: #2c5aa0 !important;
            }
            
            .scenario-subsection {
                margin-bottom: 4px !important;
                line-height: 1.1 !important;
            }
            
            .scenario-subsection strong {
                font-size: 8pt !important;
                color: #333 !important;
            }
            
            /* Listes dans les annexes */
            .annexe-scenario-content ul,
            .annexe-interventions-content ul,
            .annexe-informations-content ul,
            .annexe-theorie-content ul,
            .scenario-section ul,
            .scenario-subsection ul {
                margin: 2px 0 !important;
                padding-left: 16px !important;
            }
            
            .annexe-scenario-content li,
            .annexe-interventions-content li,
            .annexe-informations-content li,
            .annexe-theorie-content li,
            .scenario-section li,
            .scenario-subsection li {
                margin-bottom: 1px !important;
                line-height: 1.1 !important;
                font-size: 7.5pt !important;
            }
            
            /* Texte dans les sections */
            .scenario-section p,
            .scenario-subsection p {
                margin: 2px 0 !important;
                line-height: 1.1 !important;
                font-size: 7.5pt !important;
            }
            
            /* Info de base du patient */
            .scenario-info {
                font-size: 8pt !important;
                padding: 6px !important;
                margin-bottom: 8px !important;
                line-height: 1.2 !important;
            }
            
            /* Forcer les couleurs */
            * { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
            }
            
            /* Fond blanc partout */
            body, .container, .section, .section-content { background: white !important; }
            
        }
    </style>
</head>
<body class="revision-mode">
    <!-- MODE SELECTOR -->
    <div class="mode-selector">
        <button class="mode-button active" onclick="switchMode('revision')">🔍 Révision</button>
        <button class="mode-button" onclick="switchMode('exam')">📝 Examen</button>
    </div>
    
    <!-- BOUTONS RÉVISION (Mode Révision uniquement) -->
    <div class="revision-controls">
        <button class="lacune-button" onclick="identifyLacunes()">🎯 Identifier les lacunes</button>
        <button class="reset-revision-button" onclick="resetTimer()">↻ Reset</button>
    </div>
    
    <!-- MINUTEUR ECOS -->
    <div class="timer-container" id="timerContainer">
        <div class="timer-display" id="timerDisplay">13:00</div>
        <div class="timer-controls">
            <button id="startBtn" class="timer-btn start-btn" onclick="startTimer()">▶ Démarrer</button>
            <button id="stopBtn" class="timer-btn stop-btn" onclick="stopTimer()" style="display: none;">⏸ Arrêter</button>
            <button id="resetBtn" class="timer-btn reset-btn" onclick="resetTimer()">↻ Reset</button>
        </div>
        <div class="timer-status" id="timerStatus" style="display: none;"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Grille d'évaluation ECOS - Douleur abdo 4</h1>
            <p style="margin: 5px 0;">📍 Urgences</p>
            <p style="margin: 5px 0;">👤 Mme Marie Gerber, 30 ans, patiente connue pour une obésité (BMI: 30) consulte aux urgences pour une douleur abdominale</p>
            <div class="vital-signs">
                <div class="vital-sign">
                    <div class="vital-sign-label">TA</div>
                    <div class="vital-sign-value">120/80 mmHg</div>
                </div>
                <div class="vital-sign">
                    <div class="vital-sign-label">T°</div>
                    <div class="vital-sign-value">37.3°C</div>
                </div>
                <div class="vital-sign">
                    <div class="vital-sign-label">SaO2</div>
                    <div class="vital-sign-value">99%</div>
                </div>
                <div class="vital-sign">
                    <div class="vital-sign-label">IMC</div>
                    <div class="vital-sign-value">30 kg/m²</div>
                </div>
            </div>
        </div>
        <!-- ANAMNÈSE -->
        <div class="section">
            <div class="section-header">
                <span>Anamnèse (25%)</span>
                <span class="score">Score : <span id="anamneseScore">0</span>/33</span>
            </div>
            <div class="section-content">
                <div class="header-row">
                    <div>Critères</div>
                    <div>Oui</div>
                    <div>±</div>
                    <div>Non</div>
                    <div>Points</div>
                </div>
<div class="criteria-row" id="criteria-a1">
    <div>
        <div class="criteria-text">1. Caractérisation de la douleur <button class="comment-button" onclick="toggleComment('a1')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Localisation précise <span class="patient-response">[QIG]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a1-detail-0" value="1" onchange="updateDetailScore('a1', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Intensité <span class="patient-response">[10/10]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a1-detail-1" value="1" onchange="updateDetailScore('a1', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Qualité <span class="patient-response">[coup de poignard]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a1-detail-2" value="1" onchange="updateDetailScore('a1', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Irradiation <span class="patient-response">[irradiation vers les parties génitales]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a1-detail-3" value="1" onchange="updateDetailScore('a1', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Facteurs aggravants <span class="patient-response">[les mouvements]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a1-detail-4" value="1" onchange="updateDetailScore('a1', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Facteurs soulageants <span class="patient-response">[aucun]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a1-detail-5" value="1" onchange="updateDetailScore('a1', 'a')" /></label>    </div></div></div><div class="scoring-rule">Au moins cinq = oui, quatre = ±, aucun à trois = non</div>        <div class="criterion-comment-section" id="comment-section-a1">
            <textarea class="comment-textarea" id="comment-a1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a1'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a1">0</div>
</div>
<div class="criteria-row" id="criteria-a2">
    <div>
        <div class="criteria-text">2. Chronologie de la douleur <button class="comment-button" onclick="toggleComment('a2')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Début <span class="patient-response">[survenue soudainement ce matin vers 8h30]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a2-detail-0" value="1" onchange="updateDetailScore('a2', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Progression <span class="patient-response">[péjoration graduelle de la douleur]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a2-detail-1" value="1" onchange="updateDetailScore('a2', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Circonstances de survenue <span class="patient-response">[survenue alors qu'elle était en train de faire ses courses, n'a pas fait de mouvement particulier]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a2-detail-2" value="1" onchange="updateDetailScore('a2', 'a')" /></label>    </div></div></div><div class="scoring-rule">Les trois = oui, deux = ±, aucun à un = non</div>        <div class="criterion-comment-section" id="comment-section-a2">
            <textarea class="comment-textarea" id="comment-a2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a2'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a2">0</div>
</div>
<div class="criteria-row" id="criteria-a3">
    <div>
        <div class="criteria-text">3. État général <button class="comment-button" onclick="toggleComment('a3')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Fièvre <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a3-detail-0" value="1" onchange="updateDetailScore('a3', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Fatigue <span class="patient-response">[oui, fatigue]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a3-detail-1" value="1" onchange="updateDetailScore('a3', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Perte/prise de poids récente <span class="patient-response">[obésité]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a3-detail-2" value="1" onchange="updateDetailScore('a3', 'a')" /></label>    </div></div></div><div class="scoring-rule">Les trois = oui, un à deux = ±, aucun = non</div>        <div class="criterion-comment-section" id="comment-section-a3">
            <textarea class="comment-textarea" id="comment-a3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a3'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a3">0</div>
</div>
<div class="criteria-row" id="criteria-a4">
    <div>
        <div class="criteria-text">4. Système reproducteur (DD: grossesse extra-utérine, torsion ovarienne) <button class="comment-button" onclick="toggleComment('a4')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Test de grossesse (la patiente en a-t-elle fait un ?) <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a4-detail-0" value="1" onchange="updateDetailScore('a4', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Contraception <span class="patient-response">[aucune, pas de contraception]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a4-detail-1" value="1" onchange="updateDetailScore('a4', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Antécédent de césarienne/de grossesse <span class="patient-response">[G0P0]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a4-detail-2" value="1" onchange="updateDetailScore('a4', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Aménorrhée <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a4-detail-3" value="1" onchange="updateDetailScore('a4', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Métrorragie/ménorragie <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a4-detail-4" value="1" onchange="updateDetailScore('a4', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Pertes vaginales <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a4-detail-5" value="1" onchange="updateDetailScore('a4', 'a')" /></label>    </div></div></div><div class="scoring-rule">Au moins quatre = oui, deux à trois = ±, aucun à un = non</div>        <div class="criterion-comment-section" id="comment-section-a4">
            <textarea class="comment-textarea" id="comment-a4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a4'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a4">0</div>
</div>
<div class="criteria-row" id="criteria-a5">
    <div>
        <div class="criteria-text">5. Système digestif (DD: colite, appendicite, diverticulite) <button class="comment-button" onclick="toggleComment('a5')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Nausées <span class="patient-response">[nausées et vomissement depuis la survenue de la douleur seulement]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a5-detail-0" value="1" onchange="updateDetailScore('a5', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Vomissements <span class="patient-response">[2 épisodes de vomissement alimentaire]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a5-detail-1" value="1" onchange="updateDetailScore('a5', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Dernier transit</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a5-detail-2" value="1" onchange="updateDetailScore('a5', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Diarrhées <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a5-detail-3" value="1" onchange="updateDetailScore('a5', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Constipation <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a5-detail-4" value="1" onchange="updateDetailScore('a5', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Sang dans les selles <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a5-detail-5" value="1" onchange="updateDetailScore('a5', 'a')" /></label>    </div></div></div><div class="scoring-rule">Au moins cinq = oui, trois à quatre = ±, aucun à deux = non</div>        <div class="criterion-comment-section" id="comment-section-a5">
            <textarea class="comment-textarea" id="comment-a5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a5'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a5">0</div>
</div>
<div class="criteria-row" id="criteria-a6">
    <div>
        <div class="criteria-text">6. Système urinaire: (DD: lithiase rénale, cystite, pyélonéphrite) <button class="comment-button" onclick="toggleComment('a6')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Dysurie/algurie <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a6-detail-0" value="1" onchange="updateDetailScore('a6', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Urgenturie <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a6-detail-1" value="1" onchange="updateDetailScore('a6', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Couleur des urines <span class="patient-response">[normale]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a6-detail-2" value="1" onchange="updateDetailScore('a6', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Hématurie <span class="patient-response">[non]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a6-detail-3" value="1" onchange="updateDetailScore('a6', 'a')" /></label>    </div></div></div><div class="scoring-rule">Au moins trois = oui, deux = ±, aucun à un = non</div>        <div class="criterion-comment-section" id="comment-section-a6">
            <textarea class="comment-textarea" id="comment-a6" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a6'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a6">0</div>
</div>
<div class="criteria-row" id="criteria-a7">
    <div>
        <div class="criteria-text">7. Habitudes et antécédents personnels <button class="comment-button" onclick="toggleComment('a7')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Médicaments <span class="patient-response">[traitement topique à base de vitamines pour l'acné]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a7-detail-0" value="1" onchange="updateDetailScore('a7', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Maladies connues <span class="patient-response">[obésité (BMI: 30), dépression et anxiété suivies par psychologue, acné sévère et persistante]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a7-detail-1" value="1" onchange="updateDetailScore('a7', 'a')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Antécédents chirurgicaux <span class="patient-response">[aucune hospitalisation préalable]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="a7-detail-2" value="1" onchange="updateDetailScore('a7', 'a')" /></label>    </div></div></div><div class="scoring-rule">Les trois = oui, deux = ±, aucun à un = non</div>        <div class="criterion-comment-section" id="comment-section-a7">
            <textarea class="comment-textarea" id="comment-a7" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a7'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-a7">0</div>
</div>
<div class="criteria-row" id="criteria-a8">
    <div>
        <div class="criteria-text">8. Anamnèse en général - ciblée, fil conducteur <button class="comment-button" onclick="toggleComment('a8')" title="Ajouter un commentaire">📝</button></div>
<div class="scoring-rule">Bien = oui, suffisant = ±, insuffisant = non</div>        <div class="criterion-comment-section" id="comment-section-a8">
            <textarea class="comment-textarea" id="comment-a8" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a8'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a8" value="2" data-criteria="Anamnèse en général - ciblée, fil conducteur" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a8" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a8" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a8">0</div>
</div>
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('anamnese')" title="Commentaire sur cette section">📝 Commentaire sur la section Anamnèse</button>
                </div>
                <div class="section-comment-section" id="section-comment-anamnese">
                    <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 16px;">Commentaires sur l'anamnèse</h4>
                    <textarea class="comment-textarea" id="comment-section-anamnese" placeholder="Commentaire sur la section anamnèse..." oninput="updateSectionComment('anamnese'); autoResizeTextarea(this);"></textarea>
                </div>
            </div>
        </div>
        <!-- EXAMEN CLINIQUE -->
        <div class="section">
            <div class="section-header">
                <span>Examen clinique (25%)</span>
                <span class="score">Score : <span id="statusScore">0</span>/19</span>
            </div>
            <div class="section-content">
                <div class="header-row">
                    <div>Critères</div>
                    <div>Oui</div>
                    <div>±</div>
                    <div>Non</div>
                    <div>Points</div>
                </div>
<div class="criteria-row" id="criteria-e1">
    <div>
        <div class="criteria-text">1. S'assure du confort d'installation de la patiente <button class="comment-button" onclick="toggleComment('e1')" title="Ajouter un commentaire">📝</button></div>
        <div class="criterion-comment-section" id="comment-section-e1">
            <textarea class="comment-textarea" id="comment-e1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e1'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e1" value="2" data-criteria="S'assure du confort d'installation de la patiente" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e1" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e1">0</div>
</div>
<div class="criteria-row" id="criteria-e2">
    <div>
        <div class="criteria-text">2. Status abdominal <button class="comment-button" onclick="toggleComment('e2')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Observation</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e2-detail-0" value="1" onchange="updateDetailScore('e2', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Auscultation</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e2-detail-1" value="1" onchange="updateDetailScore('e2', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Palpation superficielle</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e2-detail-2" value="1" onchange="updateDetailScore('e2', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Palpation profonde <span class="patient-response">[douleurs intense lors de la palpation du quadrant inférieur gauche avec défense et détente]</span></div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e2-detail-3" value="1" onchange="updateDetailScore('e2', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Percussion foie et rate</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e2-detail-4" value="1" onchange="updateDetailScore('e2', 'e')" /></label>    </div></div></div><div class="scoring-rule">Les cinq = oui, quatre = ±, aucun à trois = non</div>        <div class="criterion-comment-section" id="comment-section-e2">
            <textarea class="comment-textarea" id="comment-e2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e2'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-e2">0</div>
</div>
<div class="criteria-row" id="criteria-e3">
    <div>
        <div class="criteria-text">3. Status urinaire - percussion des loges rénales <button class="comment-button" onclick="toggleComment('e3')" title="Ajouter un commentaire">📝</button></div>
        <div class="criterion-comment-section" id="comment-section-e3">
            <textarea class="comment-textarea" id="comment-e3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e3'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e3" value="2" data-criteria="Status urinaire - percussion des loges rénales" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e3" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e3">0</div>
</div>
<div class="criteria-row" id="criteria-e4">
    <div>
        <div class="criteria-text">4. Status gynécologique - 1 <button class="comment-button" onclick="toggleComment('e4')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Met des gants</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e4-detail-0" value="1" onchange="updateDetailScore('e4', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Observation du périnée, vestibule</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e4-detail-1" value="1" onchange="updateDetailScore('e4', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Lubrification correcte du spéculum</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e4-detail-2" value="1" onchange="updateDetailScore('e4', 'e')" /></label>    </div></div></div><div class="scoring-rule">Les trois = oui, deux = ±, aucun à un = non</div>        <div class="criterion-comment-section" id="comment-section-e4">
            <textarea class="comment-textarea" id="comment-e4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e4'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-e4">0</div>
</div>
<div class="criteria-row" id="criteria-e5">
    <div>
        <div class="criteria-text">5. Status gynécologique - 2 <button class="comment-button" onclick="toggleComment('e5')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">Insertion du spéculum avec angle de 45°</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e5-detail-0" value="1" onchange="updateDetailScore('e5', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Observation du col</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e5-detail-1" value="1" onchange="updateDetailScore('e5', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Palpation bi-manuelle</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e5-detail-2" value="1" onchange="updateDetailScore('e5', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Mobilisation du col à une main</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e5-detail-3" value="1" onchange="updateDetailScore('e5', 'e')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">Retire le spéculum sans le fermer</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="e5-detail-4" value="1" onchange="updateDetailScore('e5', 'e')" /></label>    </div></div></div><div class="scoring-rule">Au moins trois = oui, deux = ±, aucun à un = non</div>        <div class="criterion-comment-section" id="comment-section-e5">
            <textarea class="comment-textarea" id="comment-e5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e5'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-e5">0</div>
</div>
<div class="criteria-row" id="criteria-e6">
    <div>
        <div class="criteria-text">6. Status en général - réalisé de manière structurée, correcte et professionnelle <button class="comment-button" onclick="toggleComment('e6')" title="Ajouter un commentaire">📝</button></div>
<div class="scoring-rule">Bien = oui, suffisant = ±, insuffisant = non</div>        <div class="criterion-comment-section" id="comment-section-e6">
            <textarea class="comment-textarea" id="comment-e6" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e6'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e6" value="2" data-criteria="Status en général - réalisé de manière structurée, correcte et professionnelle" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e6" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e6" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e6">0</div>
</div>
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('examen')" title="Commentaire sur cette section">📝 Commentaire sur la section Examen</button>
                </div>
                <div class="section-comment-section" id="section-comment-examen">
                    <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 16px;">Commentaires sur l'examen clinique</h4>
                    <textarea class="comment-textarea" id="comment-section-examen" placeholder="Commentaire sur la section examen clinique..." oninput="updateSectionComment('examen'); autoResizeTextarea(this);"></textarea>
                </div>
            </div>
        </div>
        <!-- MANAGEMENT -->
        <div class="section">
            <div class="section-header">
                <span>Management (25%)</span>
                <span class="score">Score : <span id="managementScore">0</span>/12</span>
            </div>
            <div class="section-content">
                <div class="header-row">
                    <div>Critères</div>
                    <div>Oui</div>
                    <div>±</div>
                    <div>Non</div>
                    <div>Points</div>
                </div>
<div class="criteria-row" id="criteria-m1">
    <div>
        <div class="criteria-text">1. Demande un test de grossesse <button class="comment-button" onclick="toggleComment('m1')" title="Ajouter un commentaire">📝</button></div>
        <div class="criterion-comment-section" id="comment-section-m1">
            <textarea class="comment-textarea" id="comment-m1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m1'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m1" value="2" data-criteria="Demande un test de grossesse" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m1" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m1">0</div>
</div>
<div class="criteria-row" id="criteria-m2">
    <div>
        <div class="criteria-text">2. Demande un examen de laboratoire <button class="comment-button" onclick="toggleComment('m2')" title="Ajouter un commentaire">📝</button></div>
<div class="details-with-checkboxes"><div class="detail-row">    <div class="detail-text criteria-detail">FSC</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="m2-detail-0" value="1" onchange="updateDetailScore('m2', 'm')" /></label>    </div></div><div class="detail-row">    <div class="detail-text criteria-detail">CRP</div>    <div class="detail-checkboxes">        <label class="detail-checkbox"><input type="checkbox" id="m2-detail-1" value="1" onchange="updateDetailScore('m2', 'm')" /></label>    </div></div></div><div class="scoring-rule">Les deux = oui, un = ±, aucun = non</div>        <div class="criterion-comment-section" id="comment-section-m2">
            <textarea class="comment-textarea" id="comment-m2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m2'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="checkbox-group"></div>
    <div class="points-display" id="points-m2">0</div>
</div>
<div class="criteria-row" id="criteria-m3">
    <div>
        <div class="criteria-text">3. Demande un US ou un CT <button class="comment-button" onclick="toggleComment('m3')" title="Ajouter un commentaire">📝</button></div>
        <div class="criterion-comment-section" id="comment-section-m3">
            <textarea class="comment-textarea" id="comment-m3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m3'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m3" value="2" data-criteria="Demande un US ou un CT" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m3" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m3">0</div>
</div>
<div class="criteria-row" id="criteria-m4">
    <div>
        <div class="criteria-text">4. Évoque le diagnostic de torsion ovarienne <button class="comment-button" onclick="toggleComment('m4')" title="Ajouter un commentaire">📝</button></div>
        <div class="criterion-comment-section" id="comment-section-m4">
            <textarea class="comment-textarea" id="comment-m4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m4'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m4" value="2" data-criteria="Évoque le diagnostic de torsion ovarienne" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m4" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m4">0</div>
</div>
<div class="dd-section">
    <div class="dd-title">Diagnostics différentiels à considérer</div>
    <div class="dd-category">Causes gynécologiques</div>
    <div class="dd-item">• Torsion ovarienne <span class="dd-test">→ US doppler pelvien en urgence, laparoscopie si confirmé</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur brutale unilatérale<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Intensité maximale (10/10)<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Épisodes similaires antérieurs (torsion-détorsion)<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Signes d'hyperandrogénie (acné, acanthosis nigricans)<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Infertilité et cycles irréguliers (SOPK probable)<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas de masse palpable mentionnée</div>
    <div class="dd-item">• Grossesse extra-utérine <span class="dd-test">→ βHCG quantitatif, US pelvien</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Femme en âge de procréer<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas de contraception<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur pelvienne brutale<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Test de grossesse négatif<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Infertilité connue</div>
    <div class="dd-item">• Abcès tubo-ovarien <span class="dd-test">→ NFS, CRP, US pelvien, prélèvements</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur pelvienne<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Nausées/vomissements<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Absence de fièvre<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas d'antécédent d'infection pelvienne<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Début brutal</div>
    <div class="dd-category">Causes digestives</div>
    <div class="dd-item">• Appendicite <span class="dd-test">→ NFS, CRP, US ou CT abdominal</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur abdominale intense<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Nausées/vomissements<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Défense à la palpation<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Localisation QIG et non FID<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Irradiation vers parties génitales<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Signe du psoas négatif</div>
    <div class="dd-item">• Colite/diverticulite <span class="dd-test">→ CT abdominal avec injection</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur abdominale basse<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Âge compatible pour diverticulite<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Absence de troubles du transit<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas de syndrome inflammatoire clinique<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Début très brutal</div>
    <div class="dd-category">Causes urinaires</div>
    <div class="dd-item">• Lithiase rénale/colique néphrétique <span class="dd-test">→ Bandelette urinaire, ECBU, US rénal ou CT low-dose</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur intense brutale<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Irradiation possible vers organes génitaux<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas de symptômes urinaires<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Localisation non lombaire<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas d'hématurie</div>
    <div class="dd-item">• Pyélonéphrite <span class="dd-test">→ Bandelette urinaire, ECBU, NFS, CRP</span></div>
    <div class="dd-causes" style="margin-left: 40px; color: rgb(80, 90, 110); font-size: 0.9em;"><strong>Arguments POUR:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Douleur unilatérale<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Nausées<br><strong>Arguments CONTRE:</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;□ Absence de fièvre<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Pas de symptômes urinaires<br>&nbsp;&nbsp;&nbsp;&nbsp;□ Loges rénales non douloureuses</div>
</div>
<div class="criteria-row" id="criteria-m5">
    <div>
        <div class="criteria-text">5. Propose une consultation immédiate aux urgences de gynécologie <button class="comment-button" onclick="toggleComment('m5')" title="Ajouter un commentaire">📝</button></div>
        <div class="criterion-comment-section" id="comment-section-m5">
            <textarea class="comment-textarea" id="comment-m5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m5'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m5" value="2" data-criteria="Propose une consultation immédiate aux urgences de gynécologie" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m5" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m5">0</div>
</div>
<div class="criteria-row" id="criteria-m6">
    <div>
        <div class="criteria-text">6. Management en général <button class="comment-button" onclick="toggleComment('m6')" title="Ajouter un commentaire">📝</button></div>
<div class="scoring-rule">Bien = oui, suffisant = ±, insuffisant = non</div>        <div class="criterion-comment-section" id="comment-section-m6">
            <textarea class="comment-textarea" id="comment-m6" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m6'); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m6" value="2" data-criteria="Management en général" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m6" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m6" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m6">0</div>
</div>
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('management')" title="Commentaire sur cette section">📝 Commentaire sur la section Management</button>
                </div>
                <div class="section-comment-section" id="section-comment-management">
                    <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 16px;">Commentaires sur le management</h4>
                    <textarea class="comment-textarea" id="comment-section-management" placeholder="Commentaire sur la section management..." oninput="updateSectionComment('management'); autoResizeTextarea(this);"></textarea>
                </div>
            </div>
        </div>
        <!-- COMMUNICATION -->
        <div class="section communication-section-container">
            <div class="section-header">
                <span>Communication (25%)</span>
                <span class="score">Score : <span id="communicationScore">0</span>/20</span>
            </div>
            <div class="section-content">
                <div class="header-row communication-header">
                    <div>Critères</div>
                    <div>A</div>
                    <div>B</div>
                    <div>C</div>
                    <div>D</div>
                    <div>E</div>
                </div>
                <div class="communication-section" id="criteria-c1">
                    <div>
                        <div class="communication-text">1. Réponse aux sentiments et besoins du patient <button class="comment-button" onclick="toggleComment('c1')" title="Ajouter un commentaire">📝</button></div>
                        <div class="communication-desc">Empathie, écoute active, validation des émotions<br />
Explique le déroulement de la consultation et vérifie les préoccupations du patient, commence l'anamnèse par une question ouverte ; reconnaît, verbalise et légitime les émotions, fournit du soutient</div>
                        <div class="criterion-comment-section" id="comment-section-c1">
                            <textarea class="comment-textarea" id="comment-c1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c1'); autoResizeTextarea(this);"></textarea>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c1" value="A" data-criteria="Réponse aux sentiments du patient" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c1" value="B" data-criteria="Réponse aux sentiments du patient" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c1" value="C" data-criteria="Réponse aux sentiments du patient" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c1" value="D" data-criteria="Réponse aux sentiments du patient" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c1" value="E" data-criteria="Réponse aux sentiments du patient" onchange="updateScore('communication', this)" />
                    </div>
                </div>
                <div class="communication-section" id="criteria-c2">
                    <div>
                        <div class="communication-text">2. Structure de l'entretien <button class="comment-button" onclick="toggleComment('c2')" title="Ajouter un commentaire">📝</button></div>
                        <div class="communication-desc">Organisation logique, transitions fluides, gestion du temps<br />
Se présente par son nom et sa fonction, les étapes de l'entretien sont identifiables et s'enchaînent de manière logique, gestion du temps, adaptation à la situation</div>
                        <div class="criterion-comment-section" id="comment-section-c2">
                            <textarea class="comment-textarea" id="comment-c2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c2'); autoResizeTextarea(this);"></textarea>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c2" value="A" data-criteria="Structure de l'entretien" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c2" value="B" data-criteria="Structure de l'entretien" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c2" value="C" data-criteria="Structure de l'entretien" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c2" value="D" data-criteria="Structure de l'entretien" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c2" value="E" data-criteria="Structure de l'entretien" onchange="updateScore('communication', this)" />
                    </div>
                </div>
                <div class="communication-section" id="criteria-c3">
                    <div>
                        <div class="communication-text">3. Expression verbale <button class="comment-button" onclick="toggleComment('c3')" title="Ajouter un commentaire">📝</button></div>
                        <div class="communication-desc">Clarté, vocabulaire adapté, vérification de la compréhension<br />
Langage adapté au niveau du patient, pas de jargon, explications compréhensibles, reformulations quand nécessaire, répétitions des points clés, fait une synthèse de la consultation, bonne articulation, ton et volume adéquats</div>
                        <div class="criterion-comment-section" id="comment-section-c3">
                            <textarea class="comment-textarea" id="comment-c3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c3'); autoResizeTextarea(this);"></textarea>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c3" value="A" data-criteria="Expression verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c3" value="B" data-criteria="Expression verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c3" value="C" data-criteria="Expression verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c3" value="D" data-criteria="Expression verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c3" value="E" data-criteria="Expression verbale" onchange="updateScore('communication', this)" />
                    </div>
                </div>
                <div class="communication-section" id="criteria-c4">
                    <div>
                        <div class="communication-text">4. Expression non verbale <button class="comment-button" onclick="toggleComment('c4')" title="Ajouter un commentaire">📝</button></div>
                        <div class="communication-desc">Contact visuel, posture, gestuelle appropriée<br />
Distance interpersonnelle adéquate, posture adéquate, gestes adéquats, contact visuel et expression faciale adéquats, pauses quand nécessaire</div>
                        <div class="criterion-comment-section" id="comment-section-c4">
                            <textarea class="comment-textarea" id="comment-c4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c4'); autoResizeTextarea(this);"></textarea>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c4" value="A" data-criteria="Expression non verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c4" value="B" data-criteria="Expression non verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c4" value="C" data-criteria="Expression non verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c4" value="D" data-criteria="Expression non verbale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c4" value="E" data-criteria="Expression non verbale" onchange="updateScore('communication', this)" />
                    </div>
                </div>
                <div class="communication-section" id="criteria-c5">
                    <div>
                        <div class="communication-text">5. Évaluation générale de la communication <button class="comment-button" onclick="toggleComment('c5')" title="Ajouter un commentaire">📝</button></div>
                        <div class="communication-desc">Qualité globale de l'interaction médecin-patient</div>
                        <div class="criterion-comment-section" id="comment-section-c5">
                            <textarea class="comment-textarea" id="comment-c5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c5'); autoResizeTextarea(this);"></textarea>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c5" value="A" data-criteria="Évaluation générale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c5" value="B" data-criteria="Évaluation générale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c5" value="C" data-criteria="Évaluation générale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c5" value="D" data-criteria="Évaluation générale" onchange="updateScore('communication', this)" />
                    </div>
                    <div class="checkbox-group">
                        <input type="radio" name="c5" value="E" data-criteria="Évaluation générale" onchange="updateScore('communication', this)" />
                    </div>
                </div>
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('communication')" title="Commentaire sur cette section">📝 Commentaire sur la section Communication</button>
                </div>
                <div class="section-comment-section" id="section-comment-communication">
                    <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 16px;">Commentaires sur la communication</h4>
                    <textarea class="comment-textarea" id="comment-section-communication" placeholder="Commentaire sur la section communication..." oninput="updateSectionComment('communication'); autoResizeTextarea(this);"></textarea>
                </div>
            </div>
        </div>
        <!-- TOTAUX -->
        <div class="total-sections">
            <div class="total-section">
                <div class="total-label">Score Global</div>
                <div class="total-body">
                    <div class="total-score" id="totalScore">0/84</div>
                </div>
            </div>
            <div class="total-section">
                <div class="total-label">% par Section</div>
                <div class="total-pourcent-body">
                    <div class="total-pourcent-sections">
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Anamnèse</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="anamnese-percentage">0</span>%</div>
                            </div>
                        </div>
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Examen clinique</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="examen-percentage">0</span>%</div>
                            </div>
                        </div>
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Management</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="management-percentage">0</span>%</div>
                            </div>
                        </div>
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Communication</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="communication-percentage">0</span>%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="total-section">
                <div class="total-label">Note Globale</div>
                <div class="total-body">
                    <div class="total-note-globale" id="globalGrade">E</div>
                </div>
            </div>
        </div>
        <!-- ÉCHELLE DE NOTATION -->
        <div class="grade-scale" style="padding: 10px 15px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="margin: 0 0 10px 0; font-size: 16px;">Échelle de notation</h3>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; text-align: center;">
                <div>
                    <div style="font-weight: bold; font-size: 24px; color: #2c974b;">A</div>
                    <div style="font-size: 12px; color: #666;">≥90%</div>
                </div>
                <div>
                    <div style="font-weight: bold; font-size: 24px; color: #4e9cf0;">B</div>
                    <div style="font-size: 12px; color: #666;">80-89%</div>
                </div>
                <div>
                    <div style="font-weight: bold; font-size: 24px; color: #f0ad4e;">C</div>
                    <div style="font-size: 12px; color: #666;">70-79%</div>
                </div>
                <div>
                    <div style="font-weight: bold; font-size: 24px; color: #e67e22;">D</div>
                    <div style="font-size: 12px; color: #666;">60-69%</div>
                </div>
                <div>
                    <div style="font-weight: bold; font-size: 24px; color: #d9534f;">E</div>
                    <div style="font-size: 12px; color: #666;">&lt;60%</div>
                </div>
            </div>
        </div>
        <!-- ÉLÉMENTS MANQUANTS (MASQUÉS) -->
        <!-- <div class="missing-items" id="missingItems" style="display: none;">
            <h3>Éléments non évalués</h3>
            <div id="missingList"></div>
        </div> -->
<div class="annexes">
<h3>Annexes</h3>
<div class="annexes-grid">
<div class="annexe-item" data-image-id="img1">
    <div class="annexe-title">Échographie transvaginale - Torsion ovarienne</div>
    <div class="annexe-description">Image US montrant un ovaire élargi avec interruption du flux sanguin</div>
    <div class="annexe-image">
        <img src="/Users/damienfulliquet/Documents/-Medecine/-EXAMEN_FEDERAL/-ECOS_2025/-SSP/Cas cliniques traduits/Traduits/HTML/grilles_generees/html/images/douleur-abdo-4-img1.jpg" alt="Échographie transvaginale - Torsion ovarienne" />
    </div>
</div>
<div class="annexe-item" data-image-id="img2">
    <div class="annexe-title">Schéma anatomique - Torsion ovarienne</div>
    <div class="annexe-description">Illustration montrant la torsion du pédicule ovarien et ses conséquences</div>
    <div class="annexe-image">
        <img src="/Users/damienfulliquet/Documents/-Medecine/-EXAMEN_FEDERAL/-ECOS_2025/-SSP/Cas cliniques traduits/Traduits/HTML/grilles_generees/html/images/douleur-abdo-4-img2.jpg" alt="Schéma anatomique - Torsion ovarienne" />
    </div>
</div>
<div class="annexe-item" data-image-id="img3">
    <div class="annexe-title">Acanthosis nigricans</div>
    <div class="annexe-description">Photo clinique montrant une tache foncée typique sous les aisselles</div>
    <div class="annexe-image">
        <img src="/Users/damienfulliquet/Documents/-Medecine/-EXAMEN_FEDERAL/-ECOS_2025/-SSP/Cas cliniques traduits/Traduits/HTML/grilles_generees/html/images/douleur-abdo-4-img3.jpg" alt="Acanthosis nigricans" />
    </div>
</div>
<div class="annexe-item" data-image-id="img4">
    <div class="annexe-title">Algorithme diagnostique - Douleur abdominale chez la femme en âge de procréer</div>
    <div class="annexe-description">Arbre décisionnel pour la prise en charge aux urgences</div>
    <div class="annexe-image">
        <img src="/Users/damienfulliquet/Documents/-Medecine/-EXAMEN_FEDERAL/-ECOS_2025/-SSP/Cas cliniques traduits/Traduits/HTML/grilles_generees/html/images/douleur-abdo-4-img4.jpg" alt="Algorithme diagnostique - Douleur abdominale chez la femme en âge de procréer" />
    </div>
</div>
<div class="annexe-item annexe-scenario">
    <div class="annexe-title">Scénario pour la patiente standardisée</div>
    <div class="annexe-scenario-content">
        <div class="scenario-info">
            <strong>Nom :</strong> Marie Gerber |             <strong>Âge :</strong> 30 ans<br>
            <strong>Contexte :</strong> Employée de commerce consultant aux urgences pour douleur abdominale intense
        </div>
        <div class="scenario-section">
            <h4>Motif de consultation</h4>
            <p><strong>Plainte principale :</strong> «J'ai terriblement mal au ventre»</p>
            <p><strong>Si on demande s'il y a autre chose :</strong> «Je ne sais pas ce qui m'arrive, mais j'ai soudainement senti une terrible douleur au bas du ventre ce matin alors que je faisais mes courses»</p>
        </div>
        <div class="scenario-section">
            <h4>Informations personnelles</h4>
            <p><strong>Profession :</strong> Employée de commerce</p>
            <p><strong>Poids :</strong> Obèse (BMI 30-40)</p>
            <p><strong>Orientation sexuelle :</strong> Hétérosexuelle</p>
            <p><strong>État civil :</strong> Mariée</p>
            <p><strong>État d'esprit :</strong> Algique et anxieuse</p>
        </div>
        <div class="scenario-section">
            <h4>Histoire actuelle</h4>
            <div class="scenario-subsection">
                <strong>Symptôme principal :</strong>
                <ul>
                    <li>Douleur intense persistante</li>
                    <li>Localisation : QIG</li>
                    <li>Qualité : coup de poignard</li>
                    <li>Quantité/intensité : 10/10</li>
                    <li>Irradiation : irradiation vers les parties génitales</li>
                    <li>Chronologie : survenue soudainement, persistant depuis la survenue, 3-4 épisodes similaires par le passé qui se sont résolus spontanément</li>
                    <li>Développement : péjoration graduelle de la douleur</li>
                    <li>Circonstances de survenue : survenue alors qu'elle était en train de faire ses courses, n'a pas fait de mouvement particulier</li>
                    <li>Facteurs atténuants : aucun</li>
                    <li>Facteurs déclenchants/aggravants : les mouvements</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Symptômes associés :</strong>
                <ul>
                    <li>Nausées et vomissement</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Réponse aux symptômes :</strong>
                <ul>
                    <li>Est venue directement aux urgences</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Représentation de la maladie :</strong>
                <ul>
                    <li>A l'impression que quelque chose s'est déchiré à l'intérieur d'elle</li>
                </ul>
            </div>
        </div>
        <div class="scenario-section">
            <h4>Habitudes</h4>
            <ul>
                <li><strong>Alimentation :</strong> Équilibrée</li>
                <li><strong>Activité physique :</strong> Sédentaire</li>
                <li><strong>Tabac :</strong> Non fumeuse</li>
                <li><strong>Alcool :</strong> Occasionnellement, 1-2 verres de vin par semaine</li>
                <li><strong>Drogues illicites :</strong> Aucune</li>
            </ul>
        </div>
        <div class="scenario-section">
            <h4>Informations personnelles</h4>
            <ul>
                <li><strong>Profession :</strong> Employée de commerce</li>
                <li><strong>Poids :</strong> Obèse (BMI 30-40)</li>
                <li><strong>Orientation sexuelle :</strong> Hétérosexuelle</li>
                <li><strong>État civil :</strong> Mariée</li>
                <li><strong>État d'esprit durant la consultation :</strong> Algique et anxieuse</li>
            </ul>
        </div>
        <div class="scenario-section">
            <h4>Histoire médicale</h4>
            <ul>
                <li>Patiente connue pour une obésité (BMI: 30), mariée, nulligeste, nullipare (0G0P)</li>
                <li>Elle et son mari tentent d'avoir un enfant depuis >2 ans</li>
                <li>Pas d'antécédents médico-chirurgicaux notables</li>
                <li>Aucune hospitalisation préalable</li>
                <li>Elle ne prend pas de contraception</li>
                <li>Actuellement suivie par un psychologue pour une dépression et de l'anxiété</li>
                <li>Est suivie par un dermatologue pour de l'acné sévère et persistante depuis l'adolescence</li>
                <li>Elle a essayé plusieurs traitements qui n'ont pas amélioré son acné</li>
                <li>Elle essaye actuellement un traitement topique à base de vitamines</li>
                <li>Outre cela, elle ne prend pas de médicament usuellement</li>
                <li>Ses vaccins sont à jour</li>
                <li>Elle n'est connue pour aucune allergie</li>
                <li>Anamnèse familiale : Mère en BSH, Père en BSH, pas de sœur, pas de frère, Grand-père décédé d'un AVC à l'âge de 75 ans</li>
            </ul>
        </div>
        <div class="scenario-section">
            <h4>Anamnèse par systèmes</h4>
            <div class="scenario-subsection">
                <strong>Système général :</strong>
                <ul>
                    <li>Obésité</li>
                    <li>Fatigue</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Système psychiatrique :</strong>
                <ul>
                    <li>Est suivie par un psychologue pour une dépression et de l'anxiété depuis plus de 2 ans</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Système digestif :</strong>
                <ul>
                    <li>Nausées et vomissement depuis la survenue de la douleur seulement</li>
                    <li>2 épisodes de vomissement alimentaire</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Système gynécologique :</strong>
                <ul>
                    <li>G0P0</li>
                    <li>Menstruations irrégulières depuis son adolescence</li>
                    <li>Dernières règles il y a environ 1 mois</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Système dermatologique :</strong>
                <ul>
                    <li>Importante acné</li>
                    <li>Tache foncée sous les aisselles</li>
                </ul>
            </div>
        </div>
        <div class="scenario-section">
            <h4>Simulation</h4>
            <div class="scenario-subsection">
                <strong>Durant l'entretien :</strong>
                <ul>
                    <li>Penchée en avant en position algique, anxieuse, nauséeuse</li>
                </ul>
            </div>
            <div class="scenario-subsection">
                <strong>Durant le status :</strong>
                <ul>
                    <li>Douleurs intense lors de la palpation du quadrant inférieur gauche avec défense et détente</li>
                    <li>Pas de douleur lors des différents tests (signe du psoas, signe de l'obturateur négatifs)</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="annexe-item annexe-informations-expert">
    <div class="annexe-title">Informations de l'expert</div>
    <div class="annexe-informations-content">
        <div class="info-section">
            <h4>Dossier médical de l'entretien</h4>
            <p>Anamnèse actuelle : Patiente de 30 ans, connue pour une obésité (BMI: 30), dépression et acné, consulte suite à l'apparition subite d'une douleur abdominale au quadrant inférieur gauche, décrite comme des coups de couteaux à 10/10 avec irradiation vers les parties génitales. Les douleurs sont péjorées par le mouvement et aucune position soulageant les douleurs. Elle n'a pas pris d'analgésiques. La patiente mentionne également des nausées et vomissements, survenues en même temps que les douleurs. Le reste de l'anamnèse par système est sans particularité, notamment pas de dysurie ni de diarrhées/constipation. Elle mentionne avoir eu 3-4 épisodes similaires par le passé qui se sont résolus spontanément en quelques minutes. Pas de médication, notamment pas de contraception, la patiente étant actuellement en train d'essayer de concevoir un enfant avec son mari. Ses dernières menstruations datent d'environ 1 mois et un test de grossesse urinaire est négatif.</p>
        </div>
        <div class="info-section">
            <h4>Rôles et interventions de l'expert·e</h4>
            <div class="roles-interventions">
                <p style="margin: 5px 0; padding-left: 0;">Informer l'étudiant que le test de grossesse est négatif si il/elle le demande</p>
                <p style="margin: 5px 0; padding-left: 0;">Si l'étudiant demande un laboratoire sanguin : l'expert demande à l'étudiant de préciser ce qu'il/elle veut comme examen, puis lui dit que les résultats seront disponibles dans environ 40 min</p>
            </div>
        </div>
        <div class="info-section">
            <h4>Points clés</h4>
            <ul>
                <li>Tableau très évocateur de torsion ovarienne</li>
                <li>Épisodes similaires antérieurs = torsion-détorsion spontanée</li>
                <li>Syndrome des ovaires polykystiques probable (obésité, acné, hirsutisme, infertilité)</li>
                <li>Urgence chirurgicale nécessitant une prise en charge rapide</li>
                <li>Test de grossesse systématique chez toute femme en âge de procréer</li>
            </ul>
        </div>
        <div class="info-section">
            <h4>Pièges</h4>
            <ul>
                <li>Ne pas oublier le test de grossesse même si la patiente dit ne pas prendre de contraception</li>
                <li>Penser à l'examen gynécologique même aux urgences</li>
                <li>Ne pas se limiter à l'examen abdominal</li>
                <li>La douleur peut être latéralisée à gauche même si classiquement à droite pour l'appendicite</li>
            </ul>
        </div>
    </div>
</div>
<div class="annexe-item annexe-theorie-pratique">
    <div class="annexe-title">Théorie pratique concernant la vignette</div>
    <div class="annexe-theorie-content">
        <div class="theorie-section">
            <h4>Prise en charge aux urgences d'un abdomen aigu chez une femme en âge de procréer</h4>
            <p>1. Exclure une urgence vitale :</p>
            <ul>
                <li>Chez une femme en âge de procréer qui se présente aux urgences pour une douleur abdominale, il faut tout d'abord exclure une urgence vitale</li>
                <li>Commencer par s'assurer que la patiente soit stable hémodynamiquement et stabiliser si cela n'est pas le cas (voie veineuse, O2, monitoring, résuscitation)</li>
                <li>Exclure une hémorragie interne : rechercher une éventuelle notion de traumatisme et effectuer un US FAST si présente</li>
                <li>Exclure une grossesse extra-utérine : Une fois la patiente stabilisée/si la patiente est stable : faire un test de grossesse urinaire ou sanguin (mesure de hCG), car il faut exclure une grossesse extra-utérine. Si une grossesse est présente, s'assurer qu'elle soit bien intra-utérine (effectuer un US pour visualiser la grossesse)</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>Explorer d'autres DD</h4>
            <p>Une fois une urgence vitale exclue nous pouvons explorer d'autres DD possibles. La patiente présente des signes cliniques faisant suspecter un ovaire polykystique (cf. 'Clinique d'ovaire polykystique'), condition qui prédispose la patiente à une torsion ovarienne.</p>
            <ul>
                <li>Cause ovarienne : effectuer un US doppler abdominal et transvaginal. Dans le cas d'une torsion ovarienne, l'ovaire atteint est élargi et nous pouvons observer l'absence de circulation veineuse. L'ovaire élargi peut parfois se présenter comme une masse douloureuse à la palpation abdominale</li>
                <li>Causes rénales (calcul rénal, pyélonéphrite) : faire un sédiment urinaire</li>
                <li>Cause infectieuse/inflammatoire (abcès tubo-ovarien, maladie pelvienne inflammatoire) : FSC, examen gynécologique</li>
                <li>Cause gastro-intestinale (appendicite) : US montrerait un 'target sign'</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>Torsion ovarienne</h4>
            <p>Étiologie :</p>
            <ul>
                <li>Élargissement ovarien : le plus souvent dû à un kyste ovarien (par ex. Syndrome d'ovaire polykystique) / tumeur / hyperstimulation</li>
                <li>Antécédent de chirurgie pelvienne</li>
                <li>Activité physique intense</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>Clinique torsion ovarienne</h4>
            <ul>
                <li>Douleurs abdominales unilatérales, d'apparition soudaine</li>
                <li>Le plus souvent chez les femmes en âge de procréer mais peut survenir à tout âge</li>
                <li>Nausées, vomissements</li>
                <li>Masse palpable, douleur à la palpation</li>
                <li>Une torsion partielle peut se manifester comme douleur intermittente qui se résout spontanément</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>Clinique d'ovaire polykystique</h4>
            <ul>
                <li>Menstruations irrégulières</li>
                <li>Infertilité</li>
                <li>Obésité</li>
                <li>Hirsutisme</li>
                <li>Alopécie androgénique</li>
                <li>Acné vulgaris</li>
                <li>Acanthosis nigricans (taches foncées sous les aisselles)</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>DD</h4>
            <ul>
                <li>Grossesse extra-utérine</li>
                <li>Abcès tubo-ovarien</li>
                <li>Appendicite</li>
                <li>Diverticulite</li>
                <li>Calcul rénal</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>Diagnostic</h4>
            <ul>
                <li>Exclure une grossesse extra-utérine : test de grossesse (βHCG urinaire ou sanguin)</li>
                <li>Exclure une cause inflammatoire/infectieuse : labo sanguin</li>
                <li>Exclure un calcul rénal : sédiment urinaire</li>
                <li>US doppler : transvaginal et transabdominal : ovaire élargi, interruption de la circulation veineuse</li>
                <li>US appendice : exclure une appendicite : absence du 'target sign'</li>
                <li>IRM : si US non conclusif</li>
            </ul>
        </div>
        <div class="theorie-section">
            <h4>Traitement</h4>
            <p>Laparoscopie exploratrice en urgence pour une détorsion</p>
        </div>
        <div class="theorie-section">
            <h4>Prise en charge aux urgences</h4>
            <p>L'anamnèse, l'examen clinique ainsi que l'US doppler font suspecter une torsion ovarienne chez cette patiente. La prise en charge aux urgences consiste à référer la patiente aux urgences gynécologiques.</p>
        </div>
    </div>
</div>
<div class="annexe-item annexe-rappels-therapeutiques">
    <div class="annexe-title">Rappels thérapeutiques</div>
    <div class="annexe-theorie-content">
        <ul class="rappels-list">
            <li>Analgésie adaptée (morphiniques si EVA 10/10)</li>
            <li>Mise en place d'une voie veineuse</li>
            <li>Prémédication avant chirurgie selon protocole</li>
            <li>Antibioprophylaxie péri-opératoire</li>
        </ul>
    </div>
</div>
<div class="annexe-item annexe-examens-complementaires">
    <div class="annexe-title">Examens complémentaires</div>
    <div class="annexe-theorie-content">
        <ul class="examens-list">
            <li>Test de grossesse urinaire ou sanguin (βHCG) : systématique</li>
            <li>FSC, CRP : recherche syndrome inflammatoire</li>
            <li>US doppler pelvien : transvaginal et transabdominal</li>
            <li>Bandelette urinaire : exclure infection urinaire</li>
            <li>CT abdomino-pelvien si US non contributif</li>
        </ul>
    </div>
</div>
</div>
</div>
        <!-- COMMENTAIRE GÉNÉRAL -->
        <div class="section-comment-section global">
            <h4 style="margin: 0 0 10px 0; color: #2c5aa0; font-size: 18px;">Commentaire général</h4>
            <textarea class="comment-textarea" id="comment-general" placeholder="Commentaire général sur l'évaluation..." oninput="updateGeneralComment(); autoResizeTextarea(this);"></textarea>
        </div>
    </div>
    <script>
        // Déclaration des variables globales
        window.audioContext = null;
        
        function updateScore(section, element) {
            const value = element.value;
            const name = element.name;
            let pointValue;

            if (section === "communication") {
                const map = { A: 4, B: 3, C: 2, D: 1, E: 0 };
                pointValue = map[value] || 0;
                // Mettre à jour la classe de couleur pour communication
                const criteriaRow = document.getElementById("criteria-" + name);
                if (criteriaRow) {
                    criteriaRow.classList.remove("score-a", "score-b", "score-c", "score-d", "score-e", "lacune-rouge", "lacune-orange", "lacune-verte");
                    criteriaRow.classList.add("score-" + value.toLowerCase());
                    // Ajouter les classes lacune pour communication
                    if (value === "E" || value === "D") {
                        criteriaRow.classList.add("lacune-rouge");
                    } else if (value === "C") {
                        criteriaRow.classList.add("lacune-orange");
                    } else if (value === "A" || value === "B") {
                        criteriaRow.classList.add("lacune-verte");
                    }
                }
            } else {
                pointValue = Number(value) || 0;
                // Mettre à jour la classe de couleur pour autres critères
                const criteriaRow = document.getElementById("criteria-" + name);
                if (criteriaRow) {
                    criteriaRow.classList.remove("score-0", "score-1", "score-2", "lacune-rouge", "lacune-orange", "lacune-verte");
                    criteriaRow.classList.add("score-" + value);
                    // Ajouter les classes lacune pour critères normaux
                    if (pointValue === 0) {
                        criteriaRow.classList.add("lacune-rouge");
                    } else if (pointValue === 1) {
                        criteriaRow.classList.add("lacune-orange");
                    } else if (pointValue >= 2) {
                        criteriaRow.classList.add("lacune-verte");
                    }
                }
            }

            const pointsElement = document.getElementById("points-" + name);
            if (pointsElement) {
                pointsElement.textContent = pointValue;
            }

            calculateScores();
        }

        function updateDetailScore(criterionId, prefix) {
            let totalScore = 0;
            const detailCheckboxes = document.querySelectorAll('input[id^="' + criterionId + '-detail-"]');
            const maxDetailsScore = detailCheckboxes.length;
            
            detailCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    totalScore += Number(checkbox.value) || 0;
                }
            });
            
            const pointsElement = document.getElementById("points-" + criterionId);
            if (pointsElement) {
                pointsElement.textContent = totalScore;
            }
            
            // Mettre à jour la classe de couleur en fonction du score et du max
            const criteriaRow = document.getElementById("criteria-" + criterionId);
            if (criteriaRow) {
                criteriaRow.classList.remove("score-0", "score-1", "score-2", "score-3", "score-4", "score-5", "score-max", "lacune-rouge", "lacune-orange", "lacune-verte");
                
                // Déterminer la classe appropriée avec les seuils 1/3 et 2/3
                const oneThird = maxDetailsScore / 3;
                const twoThirds = (maxDetailsScore * 2) / 3;
                
                if (totalScore < oneThird) {
                    criteriaRow.classList.add("score-0");
                    criteriaRow.classList.add("lacune-rouge");
                } else if (totalScore > twoThirds) {
                    criteriaRow.classList.add("score-max");
                    criteriaRow.classList.add("lacune-verte");
                } else {
                    // Score entre 1/3 et 2/3
                    criteriaRow.classList.add("score-1");
                    criteriaRow.classList.add("lacune-orange");
                }
            }
            
            calculateScores();
        }

        function calculateScores() {
            const isNewFormat = false;
            const missingItems = [];
            let scores = {};
            let maxScores = {};
            let coef = {};
            let sectionInfo = [];

            // Configuration pour le format traditionnel
            scores = {anamnese: 0, examen: 0, management: 0, communication: 0};
            maxScores = {anamnese: 33, examen: 19, management: 12, communication: 20};
            coef = {anamnese: 0.25, examen: 0.25, management: 0.25, communication: 0.25};
            sectionInfo = [
                {key: "anamnese", prefix: "a", count: 8, label: "Anamnèse"},
                {key: "examen", prefix: "e", count: 6, label: "Examen clinique", scoreId: "statusScore"},
                {key: "management", prefix: "m", count: 6, label: "Management"},
                {key: "communication", prefix: "c", count: 5, label: "Communication", isComm: true}
            ];

            // Calcul des scores pour chaque section
            sectionInfo.forEach(section => {
                let sectionScore = 0;
                
                if (section.isComm) {
                    // Section communication spéciale
                    for (let i = 1; i <= section.count; i++) {
                        const radio = document.querySelector("input[name=\"" + section.prefix + i + "\"]:checked");
                        if (radio) {
                            const val = radio.value;
                            const map = { A: 4, B: 3, C: 2, D: 1, E: 0 };
                            sectionScore += map[val] || 0;
                        } else {
                            const criteria = document.querySelector("input[name=\"" + section.prefix + i + "\"][data-criteria]");
                            if (criteria) missingItems.push(section.label + " : " + criteria.dataset.criteria);
                        }
                    }
                } else {
                    // Sections normales
                    for (let i = 1; i <= section.count; i++) {
                        const criterionId = section.prefix + i;
                        // Vérifier si ce critère a des détails avec checkboxes
                        const detailCheckboxes = document.querySelectorAll('input[id^="' + criterionId + '-detail-"]');
                        
                        if (detailCheckboxes.length > 0) {
                            // Ce critère a des détails, on calcule le score basé sur les détails
                            let detailScore = 0;
                            let hasCheckedDetail = false;
                            detailCheckboxes.forEach(checkbox => {
                                if (checkbox.checked) {
                                    detailScore += Number(checkbox.value) || 0;
                                    hasCheckedDetail = true;
                                }
                            });
                            sectionScore += detailScore;
                            
                            if (!hasCheckedDetail) {
                                const criteria = document.querySelector("input[name=\"" + criterionId + "\"][data-criteria]");
                                if (criteria) {
                                    missingItems.push(section.label + " : " + criteria.dataset.criteria);
                                } else {
                                    // Rechercher le texte du critère directement
                                    const criteriaText = document.querySelector("#criteria-" + criterionId + " .criteria-text");
                                    if (criteriaText) {
                                        missingItems.push(section.label + " : " + criteriaText.textContent.split(". ")[1].split(" [")[0]);
                                    }
                                }
                            }
                        } else {
                            // Critère normal sans détails
                            const radio = document.querySelector("input[name=\"" + criterionId + "\"]:checked");
                            if (radio) {
                                sectionScore += Number(radio.value) || 0;
                            } else {
                                const criteria = document.querySelector("input[name=\"" + criterionId + "\"][data-criteria]");
                                if (criteria) missingItems.push(section.label + " : " + criteria.dataset.criteria);
                            }
                        }
                    }
                }
                
                scores[section.key] = sectionScore;
                const scoreId = section.scoreId || section.key + "Score";
                const scoreElement = document.getElementById(scoreId);
                if (scoreElement) scoreElement.textContent = sectionScore;
            });

            // Calcul des pourcentages par section
            let percentages = {};
            let globalPercentage = 0;
            let isStarted = false;
            
            sectionInfo.forEach(section => {
                const score = scores[section.key];
                const max = maxScores[section.key];
                const percentage = max > 0 ? (score / max) * 100 : 0;
                percentages[section.key] = percentage;
                globalPercentage += percentage * coef[section.key];
                if (score > 0) isStarted = true;
            });

            const totalScoreText = isStarted ? Math.round(globalPercentage) : 0;
            document.getElementById("totalScore").textContent = totalScoreText + "%";

            // Mise à jour des pourcentages affichés
            sectionInfo.forEach(section => {
                const percentageElement = document.getElementById(section.key + "-percentage");
                if (percentageElement) {
                    percentageElement.textContent = Math.round(percentages[section.key]);
                }
            });

            const gradeElement = document.getElementById("globalGrade");
            const totalScoreElement = document.getElementById("totalScore");
            const scoreBody = totalScoreElement ? totalScoreElement.closest(".total-body") : null;
            const gradeBody = gradeElement ? gradeElement.closest(".total-body") : null;
            const sections = sectionInfo.map(s => s.key);

            const allClasses = ["note-a", "note-b", "note-c", "note-d", "note-e", "note-neutral"];

            function getClass(p) {
                if (p === 0) return "note-neutral";
                if (p >= 90) return "note-a";
                if (p >= 80) return "note-b";
                if (p >= 70) return "note-c";
                if (p >= 60) return "note-d";
                return "note-e";
            }

            const gradeClass = getClass(globalPercentage);
            const gradeLabel = isStarted ? gradeClass.split("-")[1].toUpperCase() : "A-E";
            if (gradeElement) gradeElement.textContent = gradeLabel;

            const pourcentBody = document.querySelector(".total-pourcent-body");

            [gradeElement, scoreBody, gradeBody, pourcentBody].forEach(el => {
                if (el) {
                    el.classList.remove(...allClasses);
                    el.classList.add(gradeClass);
                }
            });

            sections.forEach(id => {
                const percentageElement = document.getElementById(id + "-percentage");
                if (percentageElement) {
                    const value = parseInt(percentageElement.textContent);
                    const section = percentageElement.closest(".total-pourcent-section");
                    const sectionClass = getClass(value);
                    if (section) {
                        section.classList.remove(...allClasses);
                        section.classList.add(sectionClass);
                    }
                }
            });

            // Appliquer les couleurs aux sections principales
            sectionInfo.forEach(section => {
                const percentage = percentages[section.key];
                const allSections = document.querySelectorAll(".section");
                allSections.forEach(sectionEl => {
                    const headerText = sectionEl.querySelector(".section-header")?.textContent || "";
                    if (headerText.includes(section.label)) {
                        const sectionClass = getClass(percentage);
                        sectionEl.classList.remove(...allClasses);
                        sectionEl.classList.add(sectionClass);
                    }
                });
            });

            if (missingItems.length > 0) {
                document.getElementById("missingItems").style.display = "block";
                document.getElementById("missingList").innerHTML = missingItems.map(item =>
                    "<div class=\"missing-item\">• " + item + "</div>"
                ).join("");
            } else {
                document.getElementById("missingItems").style.display = "none";
            }
        }
        // MINUTEUR ECOS 13 MINUTES
        window.timerInterval = null;
        window.currentSeconds = 13 * 60;
        window.isRunning = false;
        window.hasStarted = false;
        window.hasFinished = false;
        window.hasStoppedManually = false;

        window.currentMode = 'revision';

        function colorPatientResponses() {
            // Version simplifiée inspirée du générateur v1
            const elements = document.querySelectorAll('.criteria-text, .sub-criteria, .redflags-text, .dd-item, .therapy-section, .detail-text, .cloture-content');
            elements.forEach(element => {
                const text = element.innerHTML;
                // Colorer uniquement les réponses patient en bleu (pas les examens complémentaires)
                let coloredText = text.replace(/\[([^\]]+)\]/g, '<span style="color: rgb(44, 90, 160); font-weight: 500;">[$1]</span>');
                element.innerHTML = coloredText;
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            switchMode('revision');
            calculateScores();
            colorPatientResponses();
            // Appeler une deuxième fois après un court délai pour s'assurer que tout est chargé
            setTimeout(function() {
                colorPatientResponses();
            }, 100);
            // Appel supplémentaire après un délai plus long pour garantir que tout est chargé
            setTimeout(function() {
                colorPatientResponses();
            }, 500);
            // Auto-resize tous les textareas au chargement
            const allTextareas = document.querySelectorAll('.comment-textarea');
            allTextareas.forEach(textarea => {
                if (textarea.value) {
                    autoResizeTextarea(textarea);
                }
            });
        });
        
        // S'assurer que la hauteur est bien définie avant l'impression
        window.addEventListener('beforeprint', function() {
            const allTextareas = document.querySelectorAll('.comment-textarea');
            allTextareas.forEach(textarea => {
                if (textarea.value && textarea.value.trim()) {
                    // S'assurer que le textarea a une hauteur définie
                    if (!textarea.style.height || textarea.style.height === 'auto') {
                        autoResizeTextarea(textarea);
                    }
                }
            });
        });


        function initAudio() {
            if (!window.audioContext) {
                window.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playBeep() {
            initAudio();
            const oscillator = window.audioContext.createOscillator();
            const gainNode = window.audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(window.audioContext.destination);
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, window.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, window.audioContext.currentTime + 0.5);
            oscillator.start(window.audioContext.currentTime);
            oscillator.stop(window.audioContext.currentTime + 0.5);
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.9;
                utterance.volume = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function playSound(message) {
            playBeep();
            setTimeout(() => speak(message), 500);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return minutes + ":" + secs.toString().padStart(2, "0");
        }

        function toggleCheckboxes(disabled) {
            const radios = document.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                radio.disabled = disabled;
            });
            const detailCheckboxes = document.querySelectorAll('.detail-checkbox input[type="checkbox"]');
            detailCheckboxes.forEach(checkbox => {
                checkbox.disabled = disabled;
            });
        }

        function colorCriteriaByScore() {
            if (!window.hasFinished && !window.hasStoppedManually) return;

            const normalCriteriaRows = document.querySelectorAll('.criteria-row');
            normalCriteriaRows.forEach(row => {
                const id = row.id;
                if (!id) return;
                const criteriaName = id.replace('criteria-', '');
                const checkedRadio = document.querySelector('input[name="' + criteriaName + '"]:checked');
                row.classList.remove('criteria-zero-points', 'criteria-one-point', 'criteria-full-points', 'criteria-not-answered', 'lacune-rouge', 'lacune-orange', 'lacune-verte');
                if (checkedRadio) {
                    const score = Number(checkedRadio.value) || 0;
                    if (score === 0) {
                        row.classList.add('criteria-zero-points');
                        row.classList.add('lacune-rouge');
                    } else if (score === 1) {
                        row.classList.add('criteria-one-point');
                        row.classList.add('lacune-orange');
                    } else if (score >= 2) {
                        row.classList.add('criteria-full-points');
                        row.classList.add('lacune-verte');
                    }
                } else {
                    row.classList.add('criteria-not-answered');
                    row.classList.add('lacune-rouge');
                }
            });

            const communicationRows = document.querySelectorAll('.communication-section');
            communicationRows.forEach(row => {
                const id = row.id;
                if (!id) return;
                const criteriaName = id.replace('criteria-', '');
                const checkedRadio = document.querySelector('input[name="' + criteriaName + '"]:checked');
                row.classList.remove('communication-note-a', 'communication-note-b', 'communication-note-c', 'communication-note-d', 'communication-note-e', 'communication-not-answered', 'lacune-rouge', 'lacune-orange', 'lacune-verte');
                if (checkedRadio) {
                    const grade = checkedRadio.value.toLowerCase();
                    row.classList.add("communication-note-" + grade);
                    if (grade === 'e' || grade === 'd') {
                        row.classList.add('lacune-rouge');
                    } else if (grade === 'c') {
                        row.classList.add('lacune-orange');
                    } else if (grade === 'a' || grade === 'b') {
                        row.classList.add('lacune-verte');
                    }
                } else {
                    row.classList.add('communication-not-answered');
                    row.classList.add('lacune-rouge');
                }
            });
        }

        function startTimer() {
            if (window.isRunning || window.currentMode !== 'exam') return;
            window.isRunning = true;
            window.hasStarted = true;
            window.hasStoppedManually = false;
            document.body.classList.add('timer-running');
            toggleCheckboxes(false);
            playSound("Début de la station");
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('timerStatus').textContent = 'En cours';
            document.getElementById('timerStatus').className = 'timer-status status-running';
            
            window.timerInterval = setInterval(() => {
                window.currentSeconds--;
                document.getElementById('timerDisplay').textContent = formatTime(window.currentSeconds);
                const container = document.getElementById('timerContainer');
                if (window.currentSeconds === 2 * 60) {
                    if (window.currentMode === 'exam') {
                        playSound("Il vous reste 2 minutes");
                    }
                    container.classList.add('timer-warning');
                    document.getElementById('timerStatus').textContent = '2 min restantes';
                    document.getElementById('timerStatus').className = 'timer-status status-warning';
                }
                if (window.currentSeconds <= 30) {
                    container.classList.add('timer-critical');
                }
                if (window.currentSeconds <= 0) {
                    endTimer();
                }
            }, 1000);
        }

        function stopTimer() {
            if (!window.isRunning) return;
            clearInterval(window.timerInterval);
            window.isRunning = false;
            window.hasStoppedManually = true;
            document.body.classList.remove('timer-running');
            // Ne pas désactiver les checkboxes pour permettre de continuer à cocher après arrêt
            // toggleCheckboxes(true);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('timerStatus').textContent = 'Arrêté';
            document.getElementById('timerStatus').className = 'timer-status';
            colorCriteriaByScore();
        }

        function endTimer() {
            clearInterval(window.timerInterval);
            window.isRunning = false;
            window.hasFinished = true;
            window.currentSeconds = 0;
            document.body.classList.remove('timer-running');
            if (window.currentMode === 'exam') {
                playSound("Fin de la station. Veuillez sortir");
                // Repasser automatiquement en mode révision après la fin du timer
                switchMode('revision');
            }
            document.getElementById('timerDisplay').textContent = '0:00';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('timerStatus').textContent = 'Terminé';
            document.getElementById('timerStatus').className = 'timer-status status-finished';
            document.getElementById('timerStatus').style.display = 'block';
            document.getElementById('timerContainer').className = 'timer-container';
            // Ne pas désactiver les checkboxes après la fin pour permettre de continuer
            // toggleCheckboxes(true);
            colorCriteriaByScore();
        }

        function resetTimer() {
            clearInterval(window.timerInterval);
            window.timerInterval = null;
            window.currentSeconds = 13 * 60;
            window.isRunning = false;
            window.hasStarted = false;
            window.hasFinished = false;
            window.hasStoppedManually = false;
            document.getElementById('timerDisplay').textContent = '13:00';
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            // Supprimer la coloration des critères
            const criteriaAndCommRows = document.querySelectorAll('.criteria-row, .communication-section');
            criteriaAndCommRows.forEach(row => {
                row.classList.remove('score-0', 'score-1', 'score-2', 'score-a', 'score-b', 'score-c', 'score-d', 'score-e');
            });
            // Supprimer la coloration des sections
            const allSections = document.querySelectorAll('.section');
            allSections.forEach(section => {
                section.classList.remove('note-a', 'note-b', 'note-c', 'note-d', 'note-e');
                section.classList.add('note-neutral');
            });
            document.getElementById('timerStatus').style.display = 'none';
            document.getElementById('timerContainer').className = 'timer-container';
            // En mode révision, ne pas désactiver les checkboxes
            if (window.currentMode === 'exam') {
                toggleCheckboxes(true);
            }
            const allRadios = document.querySelectorAll('input[type="radio"]');
            allRadios.forEach(radio => {
                radio.checked = false;
            });
            // Réinitialiser les detail-checkboxes
            const allDetailCheckboxes = document.querySelectorAll('.detail-checkbox input[type="checkbox"]');
            allDetailCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            const allPointsDisplays = document.querySelectorAll('.points-display');
            allPointsDisplays.forEach(display => {
                display.textContent = '0';
            });
            const allCriteriaRows = document.querySelectorAll('.criteria-row');
            allCriteriaRows.forEach(row => {
                row.classList.remove('criteria-zero-points', 'criteria-one-point', 'criteria-full-points', 'criteria-not-answered', 'lacune-rouge', 'lacune-orange', 'lacune-verte');
            });
            const allCommunicationRows = document.querySelectorAll('.communication-section');
            allCommunicationRows.forEach(row => {
                row.classList.remove('communication-note-a', 'communication-note-b', 'communication-note-c', 'communication-note-d', 'communication-note-e', 'communication-not-answered', 'lacune-rouge', 'lacune-orange', 'lacune-verte');
            });
            calculateScores();
            // Supprimer tous les commentaires et cacher les textareas
            const allTextareas = document.querySelectorAll('.comment-textarea');
            allTextareas.forEach(textarea => {
                textarea.value = '';
                textarea.style.height = textarea.classList.contains('comment-textarea') && textarea.closest('.section-comment-section.global') ? '30px' : (textarea.closest('.section-comment-section') ? '28px' : '26px');
            });
            // Cacher toutes les sections de commentaires ouvertes
            const allCommentSections = document.querySelectorAll('.criterion-comment-section.show, .section-comment-section.show');
            allCommentSections.forEach(section => {
                section.classList.remove('show');
            });
            // Mettre à jour les boutons de commentaires
            const allCommentButtons = document.querySelectorAll('.comment-button, .section-comment-button');
            allCommentButtons.forEach(button => {
                button.classList.remove('has-content');
            });
        }
        
        function switchMode(mode) {
            window.currentMode = mode;
            const body = document.body;
            body.className = mode + '-mode';
            const buttons = document.querySelectorAll('.mode-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            buttons.forEach(btn => {
                if (btn.textContent.includes(mode === "revision" ? "Révision" : "Examen")) {
                    btn.classList.add("active");
                }
            });
            if (mode === 'revision') {
                toggleCheckboxes(false);
                showLacunesButton();
            } else {
                if (!window.hasStarted) {
                    toggleCheckboxes(true);
                }
                hideLacunesButton();
            }
        }
        
        function showLacunesButton() {
            const btn = document.querySelector('.lacune-button');
            if (btn) btn.style.display = 'block';
        }
        
        function hideLacunesButton() {
            const btn = document.querySelector('.lacune-button');
            if (btn) btn.style.display = 'none';
        }
        
        function identifyLacunes() {
            // Critères standards (anamnèse, examen, management)
            const criteria = document.querySelectorAll(".criteria-row");
            criteria.forEach(criterion => {
                const id = criterion.id.replace("criteria-", "");
                const pointsElement = document.getElementById("points-" + id);
                const points = pointsElement ? parseInt(pointsElement.textContent) : 0;
                
                criterion.classList.remove("lacune-rouge", "lacune-orange", "lacune-verte");
                
                if (points === 0) {
                    criterion.classList.add("lacune-rouge");
                } else if (points === 1) {
                    criterion.classList.add("lacune-orange");
                } else if (points >= 2) {
                    criterion.classList.add("lacune-verte");
                }
            });
            
            // Critères communication (échelle A-E)
            const commCriteria = document.querySelectorAll(".communication-section");
            commCriteria.forEach(criterion => {
                const id = criterion.id.replace("criteria-", "");
                const radio = document.querySelector("input[name=\"" + id + "\"]:checked");
                
                criterion.classList.remove("lacune-rouge", "lacune-orange", "lacune-verte");
                
                if (!radio) {
                    criterion.classList.add("lacune-rouge");
                } else {
                    const grade = radio.value;
                    if (grade === "E" || grade === "D") {
                        criterion.classList.add("lacune-rouge");
                    } else if (grade === "C") {
                        criterion.classList.add("lacune-orange");
                    } else if (grade === "A" || grade === "B") {
                        criterion.classList.add("lacune-verte");
                    }
                }
            });
        }
        function toggleComment(id) {
            const section = document.getElementById("comment-section-" + id);
            const textarea = document.getElementById("comment-" + id);
            if (section) {
                section.classList.toggle("show");
                // Focus automatiquement sur le textarea quand on ouvre la section
                if (section.classList.contains("show") && textarea) {
                    textarea.focus();
                }
            }
        }

        function updateCommentButton(id) {
            const textarea = document.getElementById("comment-" + id);
            const criterionRow = document.getElementById("criteria-" + id);
            const commentSection = document.getElementById("comment-section-" + id);
            if (textarea && criterionRow) {
                const button = criterionRow.querySelector(".comment-button");
                if (button) {
                    if (textarea.value.trim()) {
                        button.classList.add("has-content");
                        if (commentSection) commentSection.classList.add("has-content");
                    } else {
                        button.classList.remove("has-content");
                        if (commentSection) commentSection.classList.remove("has-content");
                    }
                }
            }
        }

        function toggleSectionComment(section) {
            const commentSection = document.getElementById("section-comment-" + section);
            const textarea = document.getElementById("comment-section-" + section);
            if (commentSection) {
                commentSection.classList.toggle("show");
                // Focus automatiquement sur le textarea quand on ouvre la section
                if (commentSection.classList.contains("show") && textarea) {
                    textarea.focus();
                }
            }
        }

        function updateSectionComment(section) {
            const textarea = document.getElementById("comment-section-" + section);
            const commentSection = document.getElementById("section-comment-" + section);
            const buttons = document.querySelectorAll(".section-comment-button");
            buttons.forEach(button => {
                if (button.getAttribute("onclick") && button.getAttribute("onclick").includes(section)) {
                    if (textarea && textarea.value.trim()) {
                        button.classList.add("has-content");
                        if (commentSection) commentSection.classList.add("has-content");
                    } else {
                        button.classList.remove("has-content");
                        if (commentSection) commentSection.classList.remove("has-content");
                    }
                }
            });
        }

        function updateGeneralComment() {
            const textarea = document.getElementById("comment-general");
            if (textarea) {
                const section = textarea.closest(".section-comment-section");
                if (section) {
                    if (textarea.value.trim()) {
                        section.classList.add("has-content");
                    } else {
                        section.classList.remove("has-content");
                    }
                }
            }
        }

        function autoResizeTextarea(textarea) {
            // Reset height to auto to get correct scrollHeight
            textarea.style.height = "auto";
            // Set new height based on content
            const newHeight = textarea.scrollHeight + 2;
            textarea.style.height = newHeight + "px";
        }

    </script>
    <!-- BOUTON IMPRIMER EN PDF -->
    <button class="print-button" onclick="window.print()">🖨️ Imprimer en PDF</button>
    <script>
        // Appel final pour s'assurer que tout est coloré
        // Forcer la coloration finale
        if (window.colorPatientResponses) {
            window.colorPatientResponses();
        }
    </script>
</body>
</html>
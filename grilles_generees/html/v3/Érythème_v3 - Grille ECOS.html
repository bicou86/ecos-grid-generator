<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Érythème_v3 - Grille ECOS</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .header { background: #2c5aa0; color: white; padding: 15px; margin: -20px -20px 20px -20px; border-radius: 8px 8px 0 0; }
        .section { margin-bottom: 30px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
        .section-header { background: #f8f9fa; padding: 15px; font-weight: bold; font-size: 18px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .section-content { padding: 15px; }
        .header-row { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px; gap: 10px; padding: 10px 0; border-bottom: 2px solid #ddd; font-weight: bold; text-align: center; }
        .header-row div:first-child { text-align: left; }
        .criteria-row { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px; gap: 10px; align-items: start; padding: 15px 0; border-bottom: 1px solid #eeeeee; }
        .criteria-row:last-child { border-bottom: none; }
        .criteria-text { font-weight: 500; }
        .sub-criteria { font-size: 0.9em; color: #666; margin-top: 5px; padding-left: 18px; line-height: 1.2; }
        .patient-response { font-size: 0.9em; color: rgba(44, 90, 160, 0.65); }
        .checkbox-group { text-align: center; }
        .points-display { text-align: center; font-weight: bold; color: #2c5aa0; font-size: 18px; }
        .scoring-rule { font-size: 0.85em; color: #888; font-style: italic; margin-top: 8px; padding-left: 20px; }
        input[type="radio"] { cursor: pointer; transform: scale(1.2); }
        input[type="radio"]:disabled { opacity: 0.3; cursor: not-allowed; }
        
        /* Styles pour les commentaires discrets */
        .comment-button { 
            background: none; 
            border: none; 
            color: #2c5aa0; 
            cursor: pointer; 
            font-size: 14px; 
            padding: 2px 6px; 
            margin-left: 8px; 
            border-radius: 3px; 
            opacity: 0.6;
            transition: all 0.2s;
        }
        .comment-button:hover { opacity: 1; background: rgba(44, 90, 160, 0.1); }
        .comment-button.has-content { opacity: 1; color: #d9534f; }
        
        .section-comment-button {
            background: rgba(44, 90, 160, 0.1);
            border: 1px solid #2c5aa0;
            color: #2c5aa0;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
            margin-left: 10px;
            border-radius: 15px;
            opacity: 0.8;
            transition: all 0.2s;
            font-weight: 500;
        }
        .section-comment-button:hover { 
            opacity: 1; 
            background: rgba(44, 90, 160, 0.2); 
            transform: scale(1.05);
        }
        .section-comment-button.has-content { 
            background: rgba(220, 53, 69, 0.1);
            border-color: #d9534f;
            color: #d9534f; 
        }
        
        .criterion-comment-section { 
            display: none; 
            margin: 8px 0 12px 20px; 
            padding: 10px; 
            background: #fafafa; 
            border-left: 3px solid #2c5aa0; 
            border-radius: 0 4px 4px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .criterion-comment-section.show { display: block; }
        
        .section-comment-section { 
            display: none;
            margin: 20px 0; 
            padding: 12px; 
            background: #f8f9fa; 
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }
        .section-comment-section.show { display: block; }
        .section-comment-section.global { 
            display: block; 
            background: #f0f8ff; 
            border-color: #2c5aa0;
        }
        /* La section commentaire global reste toujours visible sauf à l'impression */
        
        .comment-textarea { 
            width: calc(100% - 20px); 
            min-height: 50px; 
            padding: 6px; 
            margin-right: 20px;
            border: 1px solid #ddd; 
            border-radius: 3px; 
            font-family: Arial, sans-serif; 
            font-size: 0.85em; 
            resize: vertical; 
            font-style: italic;
            color: #555;
        }
        .comment-textarea:focus { 
            outline: none; 
            border-color: #2c5aa0; 
            box-shadow: 0 0 3px rgba(44, 90, 160, 0.3); 
        }
        .comment-textarea::placeholder { 
            font-style: italic; 
            color: #999; 
        }
        .score { font-weight: bold; color: hsl(216, 57%, 40%); font-size: 18px; }
        .total-sections { display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 20px; margin-bottom: 30px; }
        .total-section { display: flex; flex-direction: column; justify-content: space-between; text-align: center; background: #f0f8ff; border: 1px solid #ddd; border-radius: 8px; transition: all 0.3s; }
        .total-label { background: #f8f9fa; padding: 5px; font-weight: bold; font-size: 20px; border-bottom: 1px solid #ddd; border-radius: 8px 8px 0 0; }
        .total-body { flex: 1; display: flex; align-items: center; justify-content: center; padding: 5px; border-radius: 0 0 8px 8px; }
        .total-pourcent-body { flex: 1; padding: 10px; border-radius: 0 0 8px 8px; }
        .total-score, .total-note-globale { font-size: 56px; font-weight: bold; line-height: 1; }
        .total-pourcent-sections { display: flex; flex-wrap: nowrap; gap: 10px; height: 100%; align-items: stretch; }
        .total-pourcent-section { flex: 1 1 auto; min-width: 0; display: flex; flex-direction: column; text-align: center; background: #416caa; padding: 10px; border-radius: 5px; transition: all 0.3s; border: none; }
        .total-pourcent-section:last-child { border-right: none; }
        .total-section-label { color: #eeeeee; font-size: 14px; font-weight: normal; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pourcent-body { flex: 1; display: flex; align-items: center; justify-content: center; }
        .total-pourcent-value { font-weight: bold; font-size: 28px; line-height: 1; color: white; transition: all 0.3s; }
        .note-a { background-color: #e6f4ea; color: #2c974b; }
        .note-a.total-pourcent-section { background-color: #2c974b; }
        .note-b { background-color: #e9f3fd; color: #4e9cf0; }
        .note-b.total-pourcent-section { background-color: #4e9cf0; }
        .note-c { background-color: #fdf5e6; color: #f0ad4e; }
        .note-c.total-pourcent-section { background-color: #f0ad4e; }
        .note-d { background-color: #fceee3; color: #e67e22; }
        .note-d.total-pourcent-section { background-color: #e67e22; }
        .note-e { background-color: #fbeaea; color: #d9534f; }
        .note-e.total-pourcent-section { background-color: #d9534f; }
        .note-neutral { background-color: #f0f8ff; color: #2c5aa0; }
        .note-neutral.total-pourcent-section { background-color: #6B8BC3; }
        .note-a.total-pourcent-body { background-color: #e6f4ea; }
        .note-b.total-pourcent-body { background-color: #e9f3fd; }
        .note-c.total-pourcent-body { background-color: #fdf5e6; }
        .note-d.total-pourcent-body { background-color: #fceee3; }
        .note-e.total-pourcent-body { background-color: #fbeaea; }
        .note-neutral.total-pourcent-body { background-color: #f0f8ff; }
        .grade-scale { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .grade-scale h3 { margin-top: 0; }
        .grade-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .missing-items { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 15px; border-radius: 8px; margin-top: 20px; }
        .missing-items h3 { margin-top: 0; }
        .missing-item { color: #dc3545; font-weight: bold; }
        .annexes { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd; }
        .annexes h3 { margin-top: 0; color: #2c5aa0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .annexes-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-top: 20px; }
        .annexes-grid .annexe-item:only-child { max-width: 50%; margin: 0 auto; }
        .annexe-item { padding: 15px; background: white; border-radius: 5px; border: 1px solid #e0e0e0; }
        .annexe-title { font-weight: bold; color: #2c5aa0; margin-bottom: 8px; font-size: 16px; }
        .annexe-description { color: #666; font-style: italic; margin-bottom: 10px; font-size: 14px; }
        
        /* Masquer les titres et descriptions des annexes en mode examen */
        .exam-mode .annexe-title,
        .exam-mode .annexe-description {
            display: none !important;
        }
        .annexe-image { text-align: center; margin: 10px 0; }
        .annexe-image img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .annexe-document { background: #f0f8ff; padding: 10px; border-radius: 4px; border-left: 4px solid #2c5aa0; white-space: pre-wrap; font-family: "Courier New", monospace; font-size: 13px; }
        .communication-section { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px 80px; gap: 10px; align-items: start; padding: 15px 0; border-bottom: 1px solid #eee; }
        .communication-text { font-weight: 500; }
        .communication-desc { font-size: 0.85em; color: #666; margin-top: 5px; font-style: italic; }
        .scale-header { display: grid; grid-template-columns: 2fr 80px 80px 80px 80px 80px; gap: 10px; font-weight: bold; text-align: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 2px solid #ddd; }
        .scale-header div:first-child { text-align: left; }
        .vital-signs { margin-top: 10px; margin-bottom: 0px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; font-size: 0.9em; }
        .vital-sign { text-align: center; background: #416caa; padding: 10px; border-radius: 5px; }
        .vital-sign-label { color: #eeeeee; }
        .vital-sign-value { color: rgb(255, 255, 255); margin-top: 2px; }
        .dd-section { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .dd-title { font-weight: bold; margin-bottom: 10px; color: #2c5aa0; }
        .dd-category { margin: 10px 0; font-weight: bold; }
        .dd-item { margin-left: 20px; margin-bottom: 5px; font-weight: normal; }
        .dd-test { color: #666; font-style: italic; margin-left: 10px; }
        .therapy-section { background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .therapy-title { font-weight: bold; margin-bottom: 5px; }
        .redflags-section { background: #fff5f5; padding: 12px; margin: 8px 0; border-radius: 5px; border-left: 4px solid #dc3545; }
        .redflags-title { font-weight: bold; margin-bottom: 8px; color: #dc3545; font-size: 1.1em; }
        .redflags-item { margin: 6px 0; }
        .redflags-text { font-weight: 600; color: #dc3545; margin-bottom: 3px; }
        .redflags-description { color: #666; font-size: 0.9em; margin-left: 20px; font-style: italic; }
        
        /* MINUTEUR */
        .timer-container {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.75);
            border: 3px solid #2c5aa0;
            border-radius: 15px;
            padding: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
            min-width: 200px;
            backdrop-filter: blur(1px);
        }
        .timer-display {
            font-size: 40px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }
        .timer-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .timer-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 12px;
        }
        .start-btn {
            background: #28a745;
            color: white;
        }
        .start-btn:hover {
            background: #218838;
        }
        .stop-btn {
            background: #dc3545;
            color: white;
        }
        .stop-btn:hover {
            background: #c82333;
        }
        .reset-btn {
            background: #6c757d;
            color: white;
        }
        .reset-btn:hover {
            background: #5a6268;
        }
        .timer-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .timer-btn:disabled:hover {
            background: #6c757d;
        }
        .timer-status {
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        .status-waiting { color: #6c757d; }
        .status-running { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-finished { color: #dc3545; }
        
        /* ANIMATIONS MINUTEUR */
        .timer-warning {
            animation: pulse-warning 1s infinite;
        }
        .timer-critical {
            animation: pulse-critical 0.5s infinite;
        }
        .timer-finished {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }
        @keyframes pulse-warning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes pulse-critical {
            0%, 100% { transform: scale(1); border-color: #dc3545; }
            50% { transform: scale(1.1); border-color: #ff0000; }
        }
        
        /* COLORATION POST-MINUTEUR */
        .criteria-zero-points {
            background-color: rgba(251, 234, 234, 0.6) !important;
        }
        .criteria-one-point {
            background-color: rgba(253, 245, 230, 0.6) !important;
        }
        .criteria-full-points {
            background-color: rgba(230, 244, 234, 0.6) !important;
        }
        .criteria-not-answered {
            background-color: rgba(240, 248, 255, 0.6) !important;
        }
        
        /* COLORATION COMMUNICATION */
        .communication-note-a {
            background-color: rgba(230, 244, 234, 0.6) !important;
        }
        .communication-note-b {
            background-color: rgba(233, 243, 253, 0.6) !important;
        }
        .communication-note-c {
            background-color: rgba(253, 245, 230, 0.6) !important;
        }
        .communication-note-d {
            background-color: rgba(252, 238, 227, 0.6) !important;
        }
        .communication-note-e {
            background-color: rgba(251, 234, 234, 0.6) !important;
        }
        .communication-not-answered {
            background-color: rgba(240, 248, 255, 0.6) !important;
        }
        
        .print-button { position: fixed; bottom: 20px; right: 20px; background: #2c5aa0; color: white; border: none; padding: 15px 20px; border-radius: 50px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 12px rgba(44, 90, 160, 0.3); z-index: 1000; }
        .print-button:hover { background: #1e3f70; }
        
        /* MODE SELECTOR */
        .mode-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid #2c5aa0;
            border-radius: 30px;
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
            display: flex;
            gap: 5px;
        }
        .mode-button {
            padding: 8px 16px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            background: transparent;
            color: #2c5aa0;
        }
        .mode-button.active {
            background: #2c5aa0;
            color: white;
        }
        .mode-button:hover:not(.active) {
            background: #e8f0fe;
        }
        
        /* Mode-specific hiding */
        .revision-mode .timer-container {
            display: none !important;
        }
        .exam-mode .lacune-button {
            display: none !important;
        }
        
        /* Lacune button */
        .lacune-button {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            z-index: 1000;
        }
        .lacune-button:hover {
            background: #45a049;
        }

        @media print {
            .mode-selector {
                display: none !important;
            }
            .lacune-button {
                display: none !important;
            }
            .print-button {
                display: none;
            }
            .timer-container {
                display: none !important;
            }
            /* Optimiser les marges et la mise en page */
            @page {
                size: A4;
                margin: 10mm 9mm 10mm 10mm;
            }
            body {
                margin: 0;
                background: white;
                font-size: 10pt;
            }
            .container {
                max-width: 100%;
                margin: 0;
                box-shadow: none;
                padding: 0;
                border-radius: 8px;
            }
            .header {
                margin: 0;
                padding: 6px;
                border-radius: 8px;
                page-break-inside: avoid;
                margin-bottom: 8px;
            }
            .header h1 {
                margin: 5px 0;
                font-size: 20px;
            }
            .header p {
                margin: 3px 0;
            }
            .section {
                page-break-inside: avoid;
                margin-bottom: 8px;
            }
            .section-header {
                font-size: 15px;
                padding: 6px;
            }
            .section-content {
                padding: 6px;
            }
            /* Ajuster la grille pour mieux utiliser l'espace */
            .header-row,
            .criteria-row {
                grid-template-columns: 1fr 40px 40px 40px 65px;
                gap: 3px;
            }
            .communication-section,
            .scale-header {
                grid-template-columns: 1fr 50px 50px 50px 50px 50px;
                gap: 3px;
            }
            /* Réduire la taille des polices pour certains éléments */
            .criteria-text,
            .communication-text {
                font-size: 9.5pt;
            }
            .sub-criteria,
            .patient-response {
                font-size: 8.5pt;
            }
            .communication-desc {
                font-size: 8.5pt;
                margin-top: 2px;
            }
            .scoring-rule {
                font-size: 8pt;
                margin-top: 4px;
                padding-left: 18px;
            }
            .points-display {
                font-size: 14px;
            }
            /* Optimiser les sections de totaux */
            .total-sections {
                gap: 6px;
                margin-bottom: 6px;
            }
            .total-label {
                padding: 4px;
                font-size: 16px;
                border-radius: 8px 8px 0 0;
            }
            .total-body {
                padding: 3px;
                border-radius: 0 0 8px 8px;
            }
            .total-score,
            .total-note-globale {
                font-size: 32px;
            }
            /* ADAPTATION DES BLOCS DE POURCENTAGES */
            .total-pourcent-body {
                padding: 6px;
                border-radius: 0 0 8px 8px;
            }
            .total-pourcent-sections {
                display: flex;
                flex-wrap: nowrap;
                gap: 4px;
                align-items: stretch;
            }
            .total-pourcent-section {
                flex: 0 0 auto;
                min-width: 60px;
                padding: 6px 8px;
                white-space: nowrap;
            }
            .total-section-label {
                font-size: 11px;
                margin-bottom: 3px;
                white-space: nowrap;
            }
            .total-pourcent-value {
                font-size: 20px;
            }
            .pourcent-body {
                padding: 2px 0;
            }
            /* S'assurer que les sections importantes ne sont pas coupées */
            .total-sections,
            .grade-scale,
            .missing-items {
                page-break-inside: avoid;
            }
            /* Réduire l'espacement général */
            .criteria-row,
            .communication-section {
                padding: 4px 0;
            }
            .header-row,
            .scale-header {
                padding: 4px 0;
                margin-bottom: 6px;
            }
            /* Réduire l'espacement des signes vitaux */
            .vital-signs {
                gap: 8px;
                margin-top: 6px;
            }
            .vital-sign {
                padding: 6px;
                font-size: 0.85em;
            }
            /* Optimiser les DD sections */
            .dd-section {
                padding: 10px;
                margin: 6px 0;
            }
            .dd-title {
                margin-bottom: 6px;
                font-size: 11pt;
            }
            .dd-category {
                margin: 6px 0;
                font-size: 10pt;
            }
            .dd-item {
                margin-bottom: 3px;
                margin-left: 18px;
                font-size: 9pt;
                line-height: 1.2;
            }
            .dd-test {
                font-size: 8.5pt;
                margin-left: 8px;
            }
            /* Optimiser les therapy sections */
            .therapy-section {
                padding: 6px;
                margin: 3px 0;
            }
            .therapy-title {
                margin-bottom: 3px;
                font-size: 9.5pt;
            }
            /* Optimiser les redflags sections */
            .redflags-section {
                padding: 8px;
                margin: 4px 0;
            }
            .redflags-title {
                margin-bottom: 4px;
                font-size: 10pt;
            }
            .redflags-text {
                font-size: 9pt;
            }
            .redflags-description {
                font-size: 8.5pt;
                margin-left: 15px;
            }
            /* Réduire les marges de l'échelle de notation */
            .grade-scale {
                margin-top: 10px;
                padding: 10px;
            }
            .grade-scale h3 {
                margin: 0 0 5px 0;
                font-size: 14px;
            }
            .grade-row {
                padding: 3px 0;
            }
            /* Forcer le fond blanc partout */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* SOLUTION : Forcer l'anamnèse à commencer sur la page 1 */
            
            /* 1. Le header ne doit jamais être seul */
            .header {
                page-break-after: avoid;
            }
            
            /* 2. Permettre au container de se diviser */
            .container {
                page-break-inside: auto;
            }
            
            /* 3. Configuration spéciale pour l'anamnèse */
            .section:first-of-type {
                page-break-before: avoid !important; /* Jamais de saut avant */
                page-break-inside: auto !important; /* Peut se diviser */
            }
            
            /* 4. L'en-tête de l'anamnèse doit rester avec ses premiers critères */
            .section:first-of-type .section-header {
                page-break-after: avoid !important;
            }
            
            /* 5. Le contenu de l'anamnèse peut se diviser librement */
            .section:first-of-type .section-content {
                page-break-inside: auto !important;
            }
            
            /* 6. Mais chaque critère individuel reste intact */
            .criteria-row {
                page-break-inside: avoid;
            }
            
            /* 7. Les autres sections restent intactes */
            .section:not(:first-of-type) {
                page-break-inside: avoid;
                page-break-before: auto;
            }
            
            /* 8. IMPORTANT : Forcer le premier critère à commencer immédiatement */
            .section:first-of-type .header-row {
                page-break-after: avoid !important;
            }
            
            /* 9. Assurer une hauteur minimale pour le début de section */
            .section:first-of-type .section-content > :first-child,
            .section:first-of-type .section-content > :nth-child(2) {
                page-break-before: avoid !important;
            }
            
            /* Styles d'impression pour les commentaires */
            .comment-button,
            .section-comment-button { 
                display: none !important; 
            }
            
            .criterion-comment-section {
                page-break-inside: avoid;
                margin: 6px 0 8px 15px;
                padding: 6px 8px;
                background: #f9f9f9 !important;
                border-left: 2px solid #666 !important;
                border-radius: 0 3px 3px 0;
                box-shadow: none;
            }
            .criterion-comment-section:not(.show) {
                display: none !important;
            }
            /* Cacher les sections de commentaires qui n'ont pas de contenu */
            .criterion-comment-section.show:not(.has-content) {
                display: none !important;
            }
            
            .section-comment-section {
                page-break-inside: avoid;
                margin: 10px 0;
                padding: 8px;
                background: #f5f5f5 !important;
                border: 1px solid #ccc !important;
                border-radius: 4px;
            }
            /* Cacher toutes les sections de commentaires vides à l'impression */
            .section-comment-section {
                display: none !important;
            }
            /* Montrer seulement les sections avec contenu */
            .section-comment-section.has-content {
                display: block !important;
            }
            
            .comment-textarea {
                width: calc(100% - 15px);
                min-height: 30px;
                padding: 4px;
                margin-right: 15px;
                border: 1px solid #ccc;
                border-radius: 2px;
                font-size: 8pt;
                font-family: Arial, sans-serif;
                background: white;
                font-style: italic;
                color: #333;
                /* Force le textarea à afficher son contenu à l'impression */
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body class="revision-mode">
    <!-- MODE SELECTOR -->
    <div class="mode-selector">
        <button class="mode-button active" onclick="switchMode('revision')">🔍 Révision</button>
        <button class="mode-button" onclick="switchMode('exam')">📝 Examen</button>
    </div>
    
    <!-- BOUTON LACUNES (Mode Révision uniquement) -->
    <button class="lacune-button" onclick="identifyLacunes()">🎯 Identifier les lacunes</button>
    
    <!-- MINUTEUR -->
    <div class="timer-container" id="timerContainer">
        <div class="timer-display" id="timerDisplay">13:00</div>
        <div class="timer-controls">
            <button class="timer-btn start-btn" id="startBtn" onclick="startTimer()">▶ Démarrer</button>
            <button class="timer-btn stop-btn" id="stopBtn" onclick="stopTimer()" style="display: none;">⏸ Arrêter</button>
            <button class="timer-btn reset-btn" id="resetBtn" onclick="resetTimer()">🔄 Reset</button>
        </div>
        <div class="timer-status status-waiting" id="timerStatus">En attente</div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Grille d'évaluation ECOS - Érythème_v3</h1>
            <p style="margin: 5px 0;">Contexte : Cabinet de médecine générale</p>
            <p style="margin: 5px 0;">Patient : Mme Kählin, 27 ans, consulte suite à l'apparition d'un érythème cutané</p>
            <div class="vital-signs">
                <div class="vital-sign">
                    <div class="vital-sign-label">TA</div>
                    <div class="vital-sign-value">127/82 mmHg</div>
                </div>
                <div class="vital-sign">
                    <div class="vital-sign-label">FC</div>
                    <div class="vital-sign-value">73 bpm</div>
                </div>
                <div class="vital-sign">
                    <div class="vital-sign-label">T°</div>
                    <div class="vital-sign-value">37.8°C</div>
                </div></div>
        </div>

        <!-- ANAMNÈSE -->
        <div class="section">
            <div class="section-header">
                <span>Anamnèse (40%)</span>
                <span class="score">Score : <span id="anamneseScore">0</span>/16</span>
            </div>
            <div class="section-content">
                <div class="header-row">
                    <div>Critères</div>
                    <div>Oui</div>
                    <div>±</div>
                    <div>Non</div>
                    <div>Points</div>
                </div>
                <div class="criteria-row" id="criteria-a1">
    <div>
        <div class="criteria-text">1. Désinfection des mains, présentation avec nom, fonction et but de la consultation<button class="comment-button" onclick="toggleComment('a1')" title="Ajouter un commentaire">💬</button></div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a1" value="2" data-criteria="Désinfection des mains, présentation avec nom, fonction et but de la consultation" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group" style="visibility: hidden;">
        <input type="radio" disabled />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a1" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a1">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a1">
    <textarea class="comment-textarea" id="comment-a1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a1')"></textarea>
</div>
<div class="criteria-row" id="criteria-a2">
    <div>
        <div class="criteria-text">2. Caractérisation complète de l'érythème<button class="comment-button" onclick="toggleComment('a2')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Douleur: [non douloureux]</div><div class="sub-criteria">Brûlure: [pas de brûlure]</div><div class="sub-criteria">Prurit: [pas de démangeaisons]</div><div class="sub-criteria">Durée: [depuis environ 3 semaines]</div><div class="sub-criteria">Évolution: [progressif]</div><div class="scoring-rule">≥4 caractéristiques = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="a2" value="2" data-criteria="Caractérisation complète de l'érythème" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a2" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a2" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a2">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a2">
    <textarea class="comment-textarea" id="comment-a2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a2')"></textarea>
</div>
<div class="criteria-row" id="criteria-a3">
    <div>
        <div class="criteria-text">3. Facteurs déclenchants et modulateurs<button class="comment-button" onclick="toggleComment('a3')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Exposition solaire: [oui, pendant vacances]</div><div class="sub-criteria">Voyage récent: [Italie il y a 2 semaines]</div><div class="sub-criteria">Aggravation solaire: [érythème plus marqué en vacances]</div><div class="sub-criteria">Facteur déclenchant initial: [aucun identifié]</div><div class="sub-criteria">Médicaments photosensibilisants</div><div class="scoring-rule">≥4 facteurs explorés = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="a3" value="2" data-criteria="Facteurs déclenchants et modulateurs" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a3" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a3" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a3">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a3">
    <textarea class="comment-textarea" id="comment-a3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a3')"></textarea>
</div>
<div class="criteria-row" id="criteria-a4">
    <div>
        <div class="criteria-text">4. Recherche de RED FLAGS systémiques <span class="patient-response">[Multiples signes systémiques suggérant lupus érythémateux]</span><button class="comment-button" onclick="toggleComment('a4')" title="Ajouter un commentaire">💬</button></div>
<div class="scoring-rule">≥4 red flags recherchés = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>        <div class="redflags-section">
            <div class="redflags-item">
                <div class="redflags-text">⚠️ Fièvre persistante [température 37.8°C]</div>
            </div>
            <div class="redflags-item">
                <div class="redflags-text">⚠️ Arthralgies multiples [légères douleurs articulaires]</div>
            </div>
            <div class="redflags-item">
                <div class="redflags-text">⚠️ Fatigue inexpliquée [un peu fatiguée]</div>
            </div>
            <div class="redflags-item">
                <div class="redflags-text">⚠️ Perte de poids [possible]</div>
            </div>
            <div class="redflags-item">
                <div class="redflags-text">⚠️ Atteinte rénale (urines mousseuses) [non explorée]</div>
            </div>
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a4" value="2" data-criteria="Recherche de RED FLAGS systémiques" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a4" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a4" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a4">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a4">
    <textarea class="comment-textarea" id="comment-a4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a4')"></textarea>
</div>
<div class="criteria-row" id="criteria-a5">
    <div>
        <div class="criteria-text">5. Symptômes systémiques associés<button class="comment-button" onclick="toggleComment('a5')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Céphalées: [fréquentes]</div><div class="sub-criteria">Ulcères buccaux/nasaux</div><div class="sub-criteria">Alopécie</div><div class="sub-criteria">Phénomène de Raynaud</div><div class="sub-criteria">Sérites (douleur thoracique)</div><div class="scoring-rule">≥3 symptômes recherchés = 2 pts, 2 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="a5" value="2" data-criteria="Symptômes systémiques associés" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a5" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a5" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a5">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a5">
    <textarea class="comment-textarea" id="comment-a5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a5')"></textarea>
</div>
<div class="criteria-row" id="criteria-a6">
    <div>
        <div class="criteria-text">6. Antécédents et facteurs de risque<button class="comment-button" onclick="toggleComment('a6')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Premier épisode: [oui]</div><div class="sub-criteria">Contraception orale: [pilule combinée]</div><div class="sub-criteria">Tabac: [5 paquets-années]</div><div class="sub-criteria">AF auto-immuns</div><div class="sub-criteria">Infections récentes</div><div class="scoring-rule">≥4 éléments = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="a6" value="2" data-criteria="Antécédents et facteurs de risque" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a6" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a6" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a6">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a6">
    <textarea class="comment-textarea" id="comment-a6" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a6')"></textarea>
</div>
<div class="criteria-row" id="criteria-a7">
    <div>
        <div class="criteria-text">7. Revue des systèmes complète<button class="comment-button" onclick="toggleComment('a7')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Système rénal (œdèmes, dysurie)</div><div class="sub-criteria">Système respiratoire (dyspnée, toux)</div><div class="sub-criteria">Système neurologique (paresthésies)</div><div class="sub-criteria">Système hématologique (ecchymoses)</div><div class="sub-criteria">[Rien de particulier]</div><div class="scoring-rule">≥4 systèmes = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="a7" value="2" data-criteria="Revue des systèmes complète" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a7" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a7" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a7">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a7">
    <textarea class="comment-textarea" id="comment-a7" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a7')"></textarea>
</div>
<div class="criteria-row" id="criteria-a8">
    <div>
        <div class="criteria-text">8. Évaluation globale de la qualité de l'anamnèse<button class="comment-button" onclick="toggleComment('a8')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Anamnèse orientée pathologie auto-immune</div><div class="sub-criteria">RED FLAGS systématiquement recherchés</div><div class="sub-criteria">Facteurs de risque identifiés</div><div class="scoring-rule">Excellente = 2 pts, suffisante = 1 pt, insuffisante = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="a8" value="2" data-criteria="Évaluation globale de la qualité de l'anamnèse" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a8" value="1" onchange="updateScore('a', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="a8" value="0" onchange="updateScore('a', this)" />
    </div>
    <div class="points-display" id="points-a8">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-a8">
    <textarea class="comment-textarea" id="comment-a8" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('a8')"></textarea>
</div>

                
                <!-- Section commentaire Anamnèse -->
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('anamnese')" title="Commentaire sur cette section">📝 Commentaire sur l'Anamnèse</button>
                </div>
                <div class="section-comment-section" id="section-comment-anamnese">
                    <textarea class="comment-textarea" id="comment-section-anamnese" placeholder="Commentaire sur l'anamnèse..." oninput="updateSectionComment('anamnese')"></textarea>
                </div>
            </div>
        </div>

        <!-- EXAMEN CLINIQUE -->
        <div class="section">
            <div class="section-header">
                <span>Examen clinique (30%)</span>
                <span class="score">Score : <span id="statusScore">0</span>/14</span>
            </div>
            <div class="section-content">
                <div class="header-row">
                    <div>Critères</div>
                    <div>Oui</div>
                    <div>±</div>
                    <div>Non</div>
                    <div>Points</div>
                </div>
                <div class="criteria-row" id="criteria-e1">
    <div>
        <div class="criteria-text">1. Examen général et muqueux<button class="comment-button" onclick="toggleComment('e1')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">État général</div><div class="sub-criteria">Yeux: [légèrement secs et rouges]</div><div class="sub-criteria">Muqueuses buccales: [rosées]</div><div class="sub-criteria">Recherche ulcérations</div><div class="sub-criteria">Adénopathies</div><div class="scoring-rule">≥4 éléments = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e1" value="2" data-criteria="Examen général et muqueux" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e1" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e1" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e1">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e1">
    <textarea class="comment-textarea" id="comment-e1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e1')"></textarea>
</div>
<div class="criteria-row" id="criteria-e2">
    <div>
        <div class="criteria-text">2. Examen cutané détaillé et spécifique<button class="comment-button" onclick="toggleComment('e2')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Description: érythème rouge légèrement squameux</div><div class="sub-criteria">Distribution: dos (photosensible)</div><div class="sub-criteria">Recherche éruption malaire</div><div class="sub-criteria">Recherche lésions discoïdes</div><div class="sub-criteria">Photographie documentée</div><div class="scoring-rule">≥4 caractéristiques = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e2" value="2" data-criteria="Examen cutané détaillé et spécifique" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e2" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e2" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e2">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e2">
    <textarea class="comment-textarea" id="comment-e2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e2')"></textarea>
</div>
<div class="criteria-row" id="criteria-e3">
    <div>
        <div class="criteria-text">3. Examen articulaire systématique<button class="comment-button" onclick="toggleComment('e3')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Palpation: [articulations légèrement douloureuses]</div><div class="sub-criteria">Gonflement: [pas d'épanchement]</div><div class="sub-criteria">Limitation: [non]</div><div class="sub-criteria">Déformation</div><div class="sub-criteria">Chaleur locale</div><div class="scoring-rule">≥4 aspects = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e3" value="2" data-criteria="Examen articulaire systématique" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e3" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e3" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e3">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e3">
    <textarea class="comment-textarea" id="comment-e3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e3')"></textarea>
</div>
<div class="criteria-row" id="criteria-e4">
    <div>
        <div class="criteria-text">4. Recherche signes spécifiques de lupus<button class="comment-button" onclick="toggleComment('e4')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Éruption malaire: [absente]</div><div class="sub-criteria">Ulcérations buccales: [absentes]</div><div class="sub-criteria">Alopécie: [absente]</div><div class="sub-criteria">Phénomène de Raynaud: [absent]</div><div class="sub-criteria">Livedo reticularis</div><div class="scoring-rule">≥4 signes recherchés = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e4" value="2" data-criteria="Recherche signes spécifiques de lupus" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e4" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e4" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e4">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e4">
    <textarea class="comment-textarea" id="comment-e4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e4')"></textarea>
</div>
<div class="criteria-row" id="criteria-e5">
    <div>
        <div class="criteria-text">5. Examen systémique complet<button class="comment-button" onclick="toggleComment('e5')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Cardio-pulmonaire: [sans particularité]</div><div class="sub-criteria">Neurologique: [pas d'anomalie]</div><div class="sub-criteria">Abdominal (hépato-splénomégalie)</div><div class="sub-criteria">Rénal (œdèmes)</div><div class="sub-criteria">Tension artérielle documentée</div><div class="scoring-rule">≥4 systèmes = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e5" value="2" data-criteria="Examen systémique complet" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e5" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e5" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e5">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e5">
    <textarea class="comment-textarea" id="comment-e5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e5')"></textarea>
</div>
<div class="criteria-row" id="criteria-e6">
    <div>
        <div class="criteria-text">6. Évaluation de la sévérité<button class="comment-button" onclick="toggleComment('e6')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Extension des lésions</div><div class="sub-criteria">Signes d'activité inflammatoire</div><div class="sub-criteria">Retentissement fonctionnel</div><div class="sub-criteria">Signes de gravité systémique</div><div class="sub-criteria">Score CLASI si approprié</div><div class="scoring-rule">≥3 éléments = 2 pts, 2 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e6" value="2" data-criteria="Évaluation de la sévérité" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e6" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e6" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e6">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e6">
    <textarea class="comment-textarea" id="comment-e6" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e6')"></textarea>
</div>
<div class="criteria-row" id="criteria-e7">
    <div>
        <div class="criteria-text">7. Évaluation globale de la qualité de l'examen<button class="comment-button" onclick="toggleComment('e7')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Examen systématique orienté lupus</div><div class="sub-criteria">Signes spécifiques recherchés</div><div class="sub-criteria">Atteintes d'organes évaluées</div><div class="scoring-rule">Excellent = 2 pts, suffisant = 1 pt, insuffisant = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="e7" value="2" data-criteria="Évaluation globale de la qualité de l'examen" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e7" value="1" onchange="updateScore('e', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="e7" value="0" onchange="updateScore('e', this)" />
    </div>
    <div class="points-display" id="points-e7">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-e7">
    <textarea class="comment-textarea" id="comment-e7" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('e7')"></textarea>
</div>

                
                <!-- Section commentaire Examen clinique -->
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('examen')" title="Commentaire sur cette section">📝 Commentaire sur l'Examen clinique</button>
                </div>
                <div class="section-comment-section" id="section-comment-examen">
                    <textarea class="comment-textarea" id="comment-section-examen" placeholder="Commentaire sur l'examen clinique..." oninput="updateSectionComment('examen')"></textarea>
                </div>
            </div>
        </div>

        <!-- MANAGEMENT -->
        <div class="section">
            <div class="section-header">
                <span>Management (20%)</span>
                <span class="score">Score : <span id="managementScore">0</span>/16</span>
            </div>
            <div class="section-content">
                <div class="header-row">
                    <div>Critères</div>
                    <div>Oui</div>
                    <div>±</div>
                    <div>Non</div>
                    <div>Points</div>
                </div>
                <div class="criteria-row" id="criteria-m1">
    <div>
        <div class="criteria-text">1. Diagnostic principal et classification<button class="comment-button" onclick="toggleComment('m1')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Érythème photosensible</div><div class="sub-criteria">Évolution subaiguë (3 semaines)</div><div class="sub-criteria">Symptômes systémiques associés</div><div class="sub-criteria">Femme jeune avec contraception</div><div class="sub-criteria">Aggravation solaire documentée</div><div class="scoring-rule">Diagnostic correct avec ≥4 arguments = 2 pts, avec 2-3 arguments = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="m1" value="2" data-criteria="Diagnostic principal et classification" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m1" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m1" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m1">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m1">
    <textarea class="comment-textarea" id="comment-m1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m1')"></textarea>
</div>
<div class="criteria-row" id="criteria-m2">
    <div>
        <div class="criteria-text">2. Diagnostics différentiels structurés<button class="comment-button" onclick="toggleComment('m2')" title="Ajouter un commentaire">💬</button></div>
<div class="scoring-rule">≥6 DD pertinents = 2 pts, 3-5 DD = 1 pt, <3 DD = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="m2" value="2" data-criteria="Diagnostics différentiels structurés" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m2" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m2" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m2">0</div>
</div>
<div class="dd-section">
    <div class="dd-category">Photodermatoses</div>
    <div class="dd-item">• Lucite estivale bénigne</div>
    <div class="dd-item">• Photodermatose polymorphe</div>
    <div class="dd-item">• Dermite actinique chronique</div>
    <div class="dd-category">Dermatoses inflammatoires</div>
    <div class="dd-item">• Psoriasis</div>
    <div class="dd-item">• Dermatomyosite</div>
    <div class="dd-item">• Dermatite séborrhéique</div>
    <div class="dd-category">Causes médicamenteuses</div>
    <div class="dd-item">• Lupus induit (contraception)</div>
    <div class="dd-item">• Phototoxicité médicamenteuse</div>
    <div class="dd-item">• DRESS syndrome</div>
</div>
<div class="criterion-comment-section" id="comment-section-m2">
    <textarea class="comment-textarea" id="comment-m2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m2')"></textarea>
</div>
<div class="criteria-row" id="criteria-m3">
    <div>
        <div class="criteria-text">3. Examens complémentaires ciblés<button class="comment-button" onclick="toggleComment('m3')" title="Ajouter un commentaire">💬</button></div>
<div class="scoring-rule">≥4 examens appropriés = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="m3" value="2" data-criteria="Examens complémentaires ciblés" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m3" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m3" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m3">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m3">
    <textarea class="comment-textarea" id="comment-m3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m3')"></textarea>
</div>
<div class="criteria-row" id="criteria-m4">
    <div>
        <div class="criteria-text">4. Protection solaire et mesures générales<button class="comment-button" onclick="toggleComment('m4')" title="Ajouter un commentaire">💬</button></div>
<div class="scoring-rule">≥3 catégories complètes = 2 pts, 2 = 1 pt, <2 = 0 pt</div>        <div class="therapy-section">
            <div class="therapy-title">Photoprotection stricte</div>
            • SPF 50+ quotidien sur zones exposées<br />
            • Renouvellement toutes les 2h<br />
            • Vêtements couvrants UV<br />
            • Éviction 10h-16h<br />
            • Lunettes solaires
        </div>
        <div class="therapy-section">
            <div class="therapy-title">Adaptations lifestyle</div>
            • Arrêt tabac (aggrave lupus)<br />
            • Discussion contraception<br />
            • Gestion stress<br />
            • Activité physique adaptée<br />
            • Vitamine D si carence
        </div>
        <div class="therapy-section">
            <div class="therapy-title">Surveillance</div>
            • Auto-surveillance lésions<br />
            • Thermomètre à domicile<br />
            • Carnet symptômes<br />
            • Photos évolution<br />
            • Alertes rouges expliquées
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m4" value="2" data-criteria="Protection solaire et mesures générales" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m4" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m4" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m4">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m4">
    <textarea class="comment-textarea" id="comment-m4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m4')"></textarea>
</div>
<div class="criteria-row" id="criteria-m5">
    <div>
        <div class="criteria-text">5. Traitement médicamenteux adapté<button class="comment-button" onclick="toggleComment('m5')" title="Ajouter un commentaire">💬</button></div>
<div class="scoring-rule">≥3 options thérapeutiques = 2 pts, 2 = 1 pt, <2 = 0 pt</div>        <div class="therapy-section">
            <div class="therapy-title">Traitement local</div>
            • Dermocorticoïdes classe II-III<br />
            • 1x/j sur lésions x 2-4 sem<br />
            • Tacrolimus 0.1% si visage<br />
            • Surveillance atrophie cutanée
        </div>
        <div class="therapy-section">
            <div class="therapy-title">Antipaludéens systémiques</div>
            • Hydroxychloroquine 200-400mg/j<br />
            • Après bilan ophtalmo initial<br />
            • Efficace sur cutané + systémique<br />
            • Délai action 6-12 semaines
        </div>
        <div class="therapy-section">
            <div class="therapy-title">Si échec/sévère</div>
            • Méthotrexate 10-20mg/sem<br />
            • Azathioprine 1-2mg/kg/j<br />
            • Corticoïdes systémiques courts<br />
            • Immunosuppresseurs si systémique
        </div>
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m5" value="2" data-criteria="Traitement médicamenteux adapté" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m5" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m5" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m5">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m5">
    <textarea class="comment-textarea" id="comment-m5" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m5')"></textarea>
</div>
<div class="criteria-row" id="criteria-m6">
    <div>
        <div class="criteria-text">6. Information patient et surveillance<button class="comment-button" onclick="toggleComment('m6')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Nature auto-immune expliquée</div><div class="sub-criteria">Risque évolution systémique 5-10%</div><div class="sub-criteria">Signes d'alerte: fièvre, œdèmes, dyspnée</div><div class="sub-criteria">Importance photoprotection à vie</div><div class="sub-criteria">Grossesse à planifier (antipaludéens OK)</div><div class="scoring-rule">≥4 points abordés = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="m6" value="2" data-criteria="Information patient et surveillance" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m6" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m6" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m6">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m6">
    <textarea class="comment-textarea" id="comment-m6" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m6')"></textarea>
</div>
<div class="criteria-row" id="criteria-m7">
    <div>
        <div class="criteria-text">7. Plan de suivi structuré<button class="comment-button" onclick="toggleComment('m7')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Contrôle 4-6 semaines avec résultats</div><div class="sub-criteria">Si ANA+: bilan trimestriel initial</div><div class="sub-criteria">Surveillance rénale régulière</div><div class="sub-criteria">Ophtalmo annuel si hydroxychloroquine</div><div class="sub-criteria">Référence dermato/rhumato si besoin</div><div class="scoring-rule">≥4 éléments = 2 pts, 2-3 = 1 pt, <2 = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="m7" value="2" data-criteria="Plan de suivi structuré" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m7" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m7" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m7">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m7">
    <textarea class="comment-textarea" id="comment-m7" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m7')"></textarea>
</div>
<div class="criteria-row" id="criteria-m8">
    <div>
        <div class="criteria-text">8. Évaluation globale de la qualité de la prise en charge<button class="comment-button" onclick="toggleComment('m8')" title="Ajouter un commentaire">💬</button></div>
<div class="sub-criteria">Suspicion lupus appropriée</div><div class="sub-criteria">Bilan exhaustif programmé</div><div class="sub-criteria">Photoprotection prioritaire</div><div class="scoring-rule">Excellente = 2 pts, adéquate = 1 pt, insuffisante = 0 pt</div>    </div>
    <div class="checkbox-group">
        <input type="radio" name="m8" value="2" data-criteria="Évaluation globale de la qualité de la prise en charge" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m8" value="1" onchange="updateScore('m', this)" />
    </div>
    <div class="checkbox-group">
        <input type="radio" name="m8" value="0" onchange="updateScore('m', this)" />
    </div>
    <div class="points-display" id="points-m8">0</div>
</div>
<div class="criterion-comment-section" id="comment-section-m8">
    <textarea class="comment-textarea" id="comment-m8" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('m8')"></textarea>
</div>

                
                <!-- Section commentaire Management -->
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('management')" title="Commentaire sur cette section">📝 Commentaire sur le Management</button>
                </div>
                <div class="section-comment-section" id="section-comment-management">
                    <textarea class="comment-textarea" id="comment-section-management" placeholder="Commentaire sur le management..." oninput="updateSectionComment('management')"></textarea>
                </div>
            </div>
        </div>

        <!-- COMMUNICATION -->
        <div class="section">
            <div class="section-header">
                <span>Communication (10%)</span>
                <span class="score">Score : <span id="communicationScore">0</span>/16</span>
            </div>
            <div class="section-content">
                <div class="scale-header">
                    <div>Critères</div>
                    <div>A</div>
                    <div>B</div>
                    <div>C</div>
                    <div>D</div>
                    <div>E</div>
                </div>
                <div class="communication-section" id="criteria-c1">
                    <div>
                        <div class="communication-text">1. Réponse aux sentiments du patient<button class="comment-button" onclick="toggleComment('c1')" title="Ajouter un commentaire">💬</button></div>
                        <div class="communication-desc">Empathie, écoute active, validation des émotions</div>
                    </div>
                    <div class="checkbox-group">
                        <input data-criteria="Réponse émotionnelle" name="c1" onchange="updateScore('communication', this)" type="radio" value="A" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c1" onchange="updateScore('communication', this)" type="radio" value="B" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c1" onchange="updateScore('communication', this)" type="radio" value="C" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c1" onchange="updateScore('communication', this)" type="radio" value="D" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c1" onchange="updateScore('communication', this)" type="radio" value="E" />
                    </div>
                </div>
                <div class="criterion-comment-section" id="comment-section-c1">
                    <textarea class="comment-textarea" id="comment-c1" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c1')"></textarea>
                </div>
                <div class="communication-section" id="criteria-c2">
                    <div>
                        <div class="communication-text">2. Structure de l'entretien<button class="comment-button" onclick="toggleComment('c2')" title="Ajouter un commentaire">💬</button></div>
                        <div class="communication-desc">Organisation logique, transitions fluides, gestion du temps</div>
                    </div>
                    <div class="checkbox-group">
                        <input data-criteria="Structure" name="c2" onchange="updateScore('communication', this)" type="radio" value="A" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c2" onchange="updateScore('communication', this)" type="radio" value="B" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c2" onchange="updateScore('communication', this)" type="radio" value="C" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c2" onchange="updateScore('communication', this)" type="radio" value="D" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c2" onchange="updateScore('communication', this)" type="radio" value="E" />
                    </div>
                </div>
                <div class="criterion-comment-section" id="comment-section-c2">
                    <textarea class="comment-textarea" id="comment-c2" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c2')"></textarea>
                </div>
                <div class="communication-section" id="criteria-c3">
                    <div>
                        <div class="communication-text">3. Expression verbale<button class="comment-button" onclick="toggleComment('c3')" title="Ajouter un commentaire">💬</button></div>
                        <div class="communication-desc">Clarté, vocabulaire adapté, vérification de la compréhension</div>
                    </div>
                    <div class="checkbox-group">
                        <input data-criteria="Expression verbale" name="c3" onchange="updateScore('communication', this)" type="radio" value="A" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c3" onchange="updateScore('communication', this)" type="radio" value="B" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c3" onchange="updateScore('communication', this)" type="radio" value="C" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c3" onchange="updateScore('communication', this)" type="radio" value="D" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c3" onchange="updateScore('communication', this)" type="radio" value="E" />
                    </div>
                </div>
                <div class="criterion-comment-section" id="comment-section-c3">
                    <textarea class="comment-textarea" id="comment-c3" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c3')"></textarea>
                </div>
                <div class="communication-section" id="criteria-c4">
                    <div>
                        <div class="communication-text">4. Expression non verbale<button class="comment-button" onclick="toggleComment('c4')" title="Ajouter un commentaire">💬</button></div>
                        <div class="communication-desc">Contact visuel, posture, gestuelle appropriée</div>
                    </div>
                    <div class="checkbox-group">
                        <input data-criteria="Expression non verbale" name="c4" onchange="updateScore('communication', this)" type="radio" value="A" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c4" onchange="updateScore('communication', this)" type="radio" value="B" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c4" onchange="updateScore('communication', this)" type="radio" value="C" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c4" onchange="updateScore('communication', this)" type="radio" value="D" />
                    </div>
                    <div class="checkbox-group">
                        <input name="c4" onchange="updateScore('communication', this)" type="radio" value="E" />
                    </div>
                </div>
                <div class="criterion-comment-section" id="comment-section-c4">
                    <textarea class="comment-textarea" id="comment-c4" placeholder="Commentaire sur ce critère..." oninput="updateCommentButton('c4')"></textarea>
                </div>
                
                <!-- Section commentaire Communication -->
                <div style="text-align: center; margin: 15px 0;">
                    <button class="section-comment-button" onclick="toggleSectionComment('communication')" title="Commentaire sur cette section">📝 Commentaire sur la Communication</button>
                </div>
                <div class="section-comment-section" id="section-comment-communication">
                    <textarea class="comment-textarea" id="comment-section-communication" placeholder="Commentaire sur la communication..." oninput="updateSectionComment('communication')"></textarea>
                </div>
            </div>
        </div>

        <!-- TOTAUX -->
        <div class="total-sections">
            <div class="total-section">
                <div class="total-label">Score Global</div>
                <div class="total-body">
                    <div class="total-score" id="totalScore">0%</div>
                </div>
            </div>
            <div class="total-section">
                <div class="total-label">% par Section</div>
                <div class="total-pourcent-body">
                    <div class="total-pourcent-sections">
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Anamnèse</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="anamnese-percentage">0</span>%</div>
                            </div>
                        </div>
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Examen clinique</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="examen-percentage">0</span>%</div>
                            </div>
                        </div>
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Management</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="management-percentage">0</span>%</div>
                            </div>
                        </div>
                        <div class="total-pourcent-section">
                            <div class="total-section-label">Communication</div>
                            <div class="pourcent-body">
                                <div class="total-pourcent-value"><span id="communication-percentage">0</span>%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="total-section">
                <div class="total-label">Note Globale</div>
                <div class="total-body">
                    <div class="total-note-globale" id="globalGrade">E</div>
                </div>
            </div>
        </div>

        <!-- ÉCHELLE DE NOTATION -->
        <div class="grade-scale">
            <h3>Échelle de notation</h3>
            <div class="grade-row">
                <span>A (Excellent)</span>
                <span>≥ 56 points (90%)</span>
            </div>
            <div class="grade-row">
                <span>B (Très bien)</span>
                <span>50-54 points (80-89%)</span>
            </div>
            <div class="grade-row">
                <span>C (Bien)</span>
                <span>44-48 points (70-79%)</span>
            </div>
            <div class="grade-row">
                <span>D (Suffisant)</span>
                <span>38-42 points (60-69%)</span>
            </div>
            <div class="grade-row">
                <span>E (Insuffisant)</span>
                <span>&lt; 38 points (&lt; 60%)</span>
            </div>
        </div>

        <!-- ÉLÉMENTS MANQUANTS -->
        <div class="missing-items" id="missingItems" style="display: none;">
            <h3>Éléments non évalués</h3>
            <div id="missingList"></div>
        </div>

        <!-- COMMENTAIRE GÉNÉRAL -->
        <div class="section-comment-section global" id="section-comment-general" style="margin-top: 30px;">
            <textarea class="comment-textarea" id="comment-general" placeholder="Commentaire général sur l'évaluation..." style="min-height: 80px;" oninput="updateGeneralComment()"></textarea>
        </div>

        
        <div class="annexes">
            <h3>Annexes</h3>
            <div class="annexes-grid">
                <div class="annexe-item">
                    <div class="annexe-title">Image clinique - Érythème cutané</div>
                    <div class="annexe-description">Photographie montrant un érythème rouge légèrement squameux typique du lupus érythémateux cutané au niveau du dos</div>
                    <div class="annexe-image">
                        <img src="data:image/jpeg;base64,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" alt="Image clinique - Érythème cutané" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- BOUTON IMPRIMER EN PDF -->
    <button class="print-button" onclick="window.print()">🖨️ Imprimer en PDF</button>

    <script>
        // Variables globales pour le minuteur
        let timerInterval;
        let totalSeconds = 13 * 60; // 13 minutes
        let currentSeconds = totalSeconds;
        let isRunning = false;
        let hasStarted = false;
        let hasFinished = false;
        let hasStoppedManually = false;
        
        // Variables globales pour les modes
        let currentMode = 'revision'; // 'revision' ou 'exam'

        // Fonction pour gérer les modes d'affichage
        function updateDisplayMode() {
            const body = document.body;
            if (currentMode === 'exam') {
                body.classList.add('exam-mode');
            } else {
                body.classList.remove('exam-mode');
            }
        }

        // Fonction pour créer les sons avec synthèse vocale
        function playBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.9;
                utterance.volume = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function playSound(message) {
            playBeep();
            setTimeout(() => speak(message), 500);
        }

        // Fonction pour formater le temps
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return minutes + ':' + secs.toString().padStart(2, '0');
        }

        // Fonction pour activer/désactiver les checkboxes
        function toggleCheckboxes(disabled) {
            const checkboxes = document.querySelectorAll('input[type="radio"]');
            checkboxes.forEach(checkbox => {
                checkbox.disabled = disabled;
            });
        }

        // Fonction pour colorer les critères après la fin du minuteur ou arrêt manuel
        function colorCriteriaByScore() {
            if (!hasFinished && !hasStoppedManually) return;

            // Pour les critères normaux (anamnèse, examen, management)
            const normalCriteriaRows = document.querySelectorAll('.criteria-row');
            normalCriteriaRows.forEach(row => {
                const id = row.id;
                if (!id) return;
                
                const criteriaName = id.replace('criteria-', '');
                const checkedRadio = document.querySelector('input[name="' + criteriaName + '"]:checked');
                
                // Supprimer les classes de couleur existantes
                row.classList.remove('criteria-zero-points', 'criteria-one-point', 'criteria-full-points', 'criteria-not-answered');
                
                if (checkedRadio) {
                    const score = Number(checkedRadio.value) || 0;
                    
                    // Appliquer la couleur selon le score
                    if (score === 0) {
                        row.classList.add('criteria-zero-points');
                    } else if (score === 1) {
                        row.classList.add('criteria-one-point');
                    } else if (score >= 2) {
                        row.classList.add('criteria-full-points');
                    }
                } else {
                    // Pas de réponse
                    row.classList.add('criteria-not-answered');
                }
            });

            // Pour les critères de communication
            const communicationRows = document.querySelectorAll('.communication-section');
            communicationRows.forEach(row => {
                const id = row.id;
                if (!id) return;
                
                const criteriaName = id.replace('criteria-', '');
                const checkedRadio = document.querySelector('input[name="' + criteriaName + '"]:checked');
                
                // Supprimer les classes de couleur existantes
                row.classList.remove('communication-note-a', 'communication-note-b', 'communication-note-c', 'communication-note-d', 'communication-note-e', 'communication-not-answered');
                
                if (checkedRadio) {
                    const grade = checkedRadio.value.toLowerCase();
                    row.classList.add('communication-note-' + grade);
                } else {
                    // Pas de réponse
                    row.classList.add('communication-not-answered');
                }
            });
        }

        // Fonctions du minuteur
        function startTimer() {
            if (isRunning) return;
            
            // Basculer en mode examen et mettre à jour l'affichage
            currentMode = 'exam';
            updateDisplayMode();
            
            isRunning = true;
            hasStarted = true;
            hasStoppedManually = false;
            
            // Activer les checkboxes pendant le minuteur
            toggleCheckboxes(false);
            
            // Jouer le son de début (uniquement en mode examen)
            playSound("Début de la station");
            
            // Mise à jour de l'interface
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('timerStatus').textContent = 'En cours';
            document.getElementById('timerStatus').className = 'timer-status status-running';
            
            timerInterval = setInterval(() => {
                currentSeconds--;
                document.getElementById('timerDisplay').textContent = formatTime(currentSeconds);
                
                const container = document.getElementById('timerContainer');
                
                // Vérifier les moments clés (uniquement en mode examen)
                if (currentSeconds === 2 * 60) { // 11 minutes écoulées, 2 minutes restantes
                    if (currentMode === 'exam') {
                        playSound("Il vous reste 2 minutes");
                    }
                    container.classList.add('timer-warning');
                    document.getElementById('timerStatus').textContent = '2 min restantes';
                    document.getElementById('timerStatus').className = 'timer-status status-warning';
                }
                
                if (currentSeconds <= 30) {
                    container.classList.add('timer-critical');
                }
                
                if (currentSeconds <= 0) {
                    endTimer();
                }
            }, 1000);
        }

        function stopTimer() {
            if (!isRunning) return;
            
            clearInterval(timerInterval);
            isRunning = false;
            hasStoppedManually = true;
            
            // Repasser en mode révision et mettre à jour l'affichage
            currentMode = 'revision';
            updateDisplayMode();
            
            // Désactiver les checkboxes après arrêt manuel
            toggleCheckboxes(true);
            
            // Appliquer la coloration des critères
            colorCriteriaByScore();
            
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('timerStatus').textContent = 'Arrêté';
            document.getElementById('timerStatus').className = 'timer-status status-waiting';
            
            const container = document.getElementById('timerContainer');
            container.classList.remove('timer-warning', 'timer-critical');
        }

        function endTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            hasFinished = true;
            currentSeconds = 0;
            
            // Jouer le son de fin (uniquement en mode examen)
            if (currentMode === 'exam') {
                playSound("Fin de la station. Veuillez sortir");
            }
            
            // Repasser en mode révision et mettre à jour l'affichage
            currentMode = 'revision';
            updateDisplayMode();
            
            // Garder les checkboxes désactivées
            toggleCheckboxes(true);
            
            // Appliquer la coloration des critères
            colorCriteriaByScore();
            
            document.getElementById('timerDisplay').textContent = formatTime(0);
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('timerStatus').textContent = 'Terminé';
            document.getElementById('timerStatus').className = 'timer-status status-finished';
            
            const container = document.getElementById('timerContainer');
            container.classList.add('timer-critical');
            
            // Arrêter l'animation après 5 secondes pour éviter les rebonds infinis
            setTimeout(() => {
                container.classList.remove('timer-critical');
                container.classList.add('timer-finished');
            }, 5000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            hasStarted = false;
            hasFinished = false;
            hasStoppedManually = false;
            currentSeconds = totalSeconds;
            
            // Remettre en mode révision et mettre à jour l'affichage
            currentMode = 'revision';
            updateDisplayMode();
            
            // Désactiver les checkboxes (état initial)
            toggleCheckboxes(true);
            
            // Supprimer toutes les sélections de checkboxes
            const allRadios = document.querySelectorAll('input[type="radio"]');
            allRadios.forEach(radio => {
                radio.checked = false;
            });
            
            // Remettre tous les points à zéro
            const allPointsDisplays = document.querySelectorAll('.points-display');
            allPointsDisplays.forEach(display => {
                display.textContent = '0';
            });
            
            // Supprimer la coloration des critères
            const allCriteriaRows = document.querySelectorAll('.criteria-row, .communication-section');
            allCriteriaRows.forEach(row => {
                row.classList.remove('criteria-zero-points', 'criteria-one-point', 'criteria-full-points', 'criteria-not-answered');
                row.classList.remove('communication-note-a', 'communication-note-b', 'communication-note-c', 'communication-note-d', 'communication-note-e', 'communication-not-answered');
            });
            
            // Recalculer les scores pour remettre à zéro
            calculateScores();
            
            document.getElementById('timerDisplay').textContent = formatTime(totalSeconds);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('timerStatus').textContent = 'En attente';
            document.getElementById('timerStatus').className = 'timer-status status-waiting';
            
            const container = document.getElementById('timerContainer');
            container.classList.remove('timer-warning', 'timer-critical', 'timer-finished');
        }

        // Fonctions de gestion des modes
        function switchMode(mode) {
            currentMode = mode;
            const body = document.body;
            const buttons = document.querySelectorAll('.mode-button');
            
            // Mise à jour des classes CSS
            body.className = mode + '-mode';
            
            // Mise à jour des boutons actifs
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector('[onclick="switchMode(\'' + mode + '\')"]').classList.add('active');
            
            if (mode === 'revision') {
                // Mode révision : checkboxes toujours activées
                toggleCheckboxes(false);
            } else {
                // Mode examen : workflow classique
                if (!hasStarted) {
                    toggleCheckboxes(true);
                }
            }
        }
        
        function identifyLacunes() {
            if (currentMode !== 'revision') return;
            
            // Appliquer la coloration intelligente (même logique que colorCriteriaByScore)
            const normalCriteriaRows = document.querySelectorAll('.criteria-row');
            normalCriteriaRows.forEach(row => {
                const id = row.id;
                if (!id) return;
                
                const criteriaName = id.replace('criteria-', '');
                const checkedRadio = document.querySelector('input[name="' + criteriaName + '"]:checked');
                
                // Supprimer les classes de couleur existantes
                row.classList.remove('criteria-zero-points', 'criteria-one-point', 'criteria-full-points', 'criteria-not-answered');
                
                if (checkedRadio) {
                    const score = Number(checkedRadio.value) || 0;
                    
                    // Appliquer la couleur selon le score
                    if (score === 0) {
                        row.classList.add('criteria-zero-points');
                    } else if (score === 1) {
                        row.classList.add('criteria-one-point');
                    } else if (score >= 2) {
                        row.classList.add('criteria-full-points');
                    }
                } else {
                    // Pas de réponse
                    row.classList.add('criteria-not-answered');
                }
            });

            // Pour les critères de communication
            const communicationRows = document.querySelectorAll('.communication-section');
            communicationRows.forEach(row => {
                const id = row.id;
                if (!id) return;
                
                const criteriaName = id.replace('criteria-', '');
                const checkedRadio = document.querySelector('input[name="' + criteriaName + '"]:checked');
                
                // Supprimer les classes de couleur existantes
                row.classList.remove('communication-note-a', 'communication-note-b', 'communication-note-c', 'communication-note-d', 'communication-note-e', 'communication-not-answered');
                
                if (checkedRadio) {
                    const grade = checkedRadio.value.toLowerCase();
                    row.classList.add('communication-note-' + grade);
                } else {
                    // Pas de réponse
                    row.classList.add('communication-not-answered');
                }
            });
        }

        // Fonction pour colorer le contenu entre crochets []
        function colorPatientResponses() {
            // Sélectionner tous les éléments qui peuvent contenir des réponses patients
            const elements = document.querySelectorAll('.criteria-text, .sub-criteria');
            
            elements.forEach(element => {
                const text = element.innerHTML;
                // Remplacer tout contenu entre crochets [] par une version colorée
                const coloredText = text.replace(/\[([^\]]+)\]/g, '<span style="color: rgba(44, 90, 160, 0.8); font-weight: 500;">[$1]</span>');
                element.innerHTML = coloredText;
            });
        }

        // Initialisation: configurer le mode par défaut et colorer les réponses patients
        document.addEventListener('DOMContentLoaded', function() {
            switchMode('revision'); // Mode révision par défaut
            colorPatientResponses(); // Colorer les réponses patients entre crochets
            initializeComments(); // Initialiser l'état des commentaires
        });
        
        // Initialiser l'état des commentaires au chargement
        function initializeComments() {
            // Vérifier tous les textareas de commentaires de critères
            document.querySelectorAll('.comment-textarea').forEach(textarea => {
                if (textarea.id.startsWith('comment-') && !textarea.id.includes('section')) {
                    const criteriaId = textarea.id.replace('comment-', '');
                    updateCommentButton(criteriaId);
                }
            });
            
            // Vérifier tous les textareas de commentaires de sections
            document.querySelectorAll('[id^="comment-section-"]').forEach(textarea => {
                const sectionName = textarea.id.replace('comment-section-', '');
                updateSectionComment(sectionName);
            });
        }

        // Fonctions de scoring originales (modifiées pour inclure la coloration)
        function updateScore(section, element) {
            const value = element.value;
            const name = element.name;
            let pointValue;

            if (section === "communication") {
                const map = { A: 4, B: 3, C: 2, D: 1, E: 0 };
                pointValue = map[value] || 0;
            } else {
                pointValue = Number(value) || 0;
            }

            const pointsElement = document.getElementById("points-" + name);
            if (pointsElement) {
                pointsElement.textContent = pointValue;
            }

            calculateScores();
            
            // Appliquer la coloration si le minuteur est terminé ou arrêté manuellement
            if (hasFinished || hasStoppedManually) {
                colorCriteriaByScore();
            }
        }

        function calculateScores() {
            let anamneseScore = 0, statusScore = 0, managementScore = 0, communicationScore = 0;
            
            // Maximum scores pour chaque section
            const maxAnamnese = 8 * 2;
            const maxStatus = 7 * 2;
            const maxManagement = 8 * 2;
            const maxCommunication = 4 * 4; // 16
            const missingItems = [];

            const coef = {
                anamnese: 0.4,
                status: 0.3,
                management: 0.2,
                communication: 0.1
            };

            // Calcul du score pour Anamnèse
            for (let i = 1; i <= 8; i++) {
                const radio = document.querySelector('input[name="a' + i + '"]:checked');
                if (radio) {
                    anamneseScore += Number(radio.value) || 0;
                } else {
                    const criteria = document.querySelector('input[name="a' + i + '"][data-criteria]');
                    if (criteria) missingItems.push('Anamnèse : ' + criteria.dataset.criteria);
                }
            }
            document.getElementById("anamneseScore").textContent = anamneseScore;

            // Calcul du score pour Examen clinique
            for (let i = 1; i <= 7; i++) {
                const radio = document.querySelector('input[name="e' + i + '"]:checked');
                if (radio) {
                    statusScore += Number(radio.value) || 0;
                } else {
                    const criteria = document.querySelector('input[name="e' + i + '"][data-criteria]');
                    if (criteria) missingItems.push('Examen clinique : ' + criteria.dataset.criteria);
                }
            }
            document.getElementById("statusScore").textContent = statusScore;

            // Calcul du score pour Management
            for (let i = 1; i <= 8; i++) {
                const radio = document.querySelector('input[name="m' + i + '"]:checked');
                if (radio) {
                    managementScore += Number(radio.value) || 0;
                } else {
                    const criteria = document.querySelector('input[name="m' + i + '"][data-criteria]');
                    if (criteria) missingItems.push('Management : ' + criteria.dataset.criteria);
                }
            }
            document.getElementById("managementScore").textContent = managementScore;

            // Calcul du score pour Communication
            for (let i = 1; i <= 4; i++) {
                const radio = document.querySelector('input[name="c' + i + '"]:checked');
                if (radio) {
                    const val = radio.value;
                    const map = { A: 4, B: 3, C: 2, D: 1, E: 0 };
                    communicationScore += map[val] || 0;
                } else {
                    const criteria = document.querySelector('input[name="c' + i + '"][data-criteria]');
                    if (criteria) missingItems.push('Communication : ' + criteria.dataset.criteria);
                }
            }
            document.getElementById("communicationScore").textContent = communicationScore;

            // Calcul des pourcentages
            const anamneseP = (anamneseScore / maxAnamnese) * 100;
            const statusP = (statusScore / maxStatus) * 100;
            const managementP = (managementScore / maxManagement) * 100;
            const communicationP = (communicationScore / maxCommunication) * 100;

            const globalPercentage = anamneseP * coef.anamnese + statusP * coef.status + managementP * coef.management + communicationP * coef.communication;

            const isStarted = anamneseScore + statusScore + managementScore + communicationScore > 0;

            // Calcul du score total maximum
            const totalScoreText = isStarted ? Math.round(globalPercentage) : 0;
            document.getElementById("totalScore").textContent = totalScoreText + "%";

            // Mise à jour des pourcentages par section
            document.getElementById("anamnese-percentage").textContent = Math.round(anamneseP);
            document.getElementById("examen-percentage").textContent = Math.round(statusP);
            document.getElementById("management-percentage").textContent = Math.round(managementP);
            document.getElementById("communication-percentage").textContent = Math.round(communicationP);

            // Mise à jour de la note globale
            const gradeElement = document.getElementById("globalGrade");
            const scoreBody = document.getElementById("totalScore").closest(".total-body");
            const gradeBody = gradeElement.closest(".total-body");
            const pourcentBody = document.querySelector(".total-pourcent-body");
            const sections = ["anamnese", "examen", "management", "communication"];

            const allClasses = ["note-a", "note-b", "note-c", "note-d", "note-e", "note-neutral"];

            function getClass(p) {
                if (p === 0) return "note-neutral";
                if (p >= 90) return "note-a";
                if (p >= 80) return "note-b";
                if (p >= 70) return "note-c";
                if (p >= 60) return "note-d";
                return "note-e";
            }

            const gradeClass = getClass(globalPercentage);
            const gradeLabel = isStarted ? gradeClass.split("-")[1].toUpperCase() : "A-E";
            gradeElement.textContent = gradeLabel;

            [gradeElement, scoreBody, gradeBody, pourcentBody].forEach(el => {
                el.classList.remove(...allClasses);
                el.classList.add(gradeClass);
            });

            sections.forEach(id => {
                const value = parseInt(document.getElementById(id + "-percentage").textContent);
                const section = document.getElementById(id + "-percentage").closest(".total-pourcent-section");
                const sectionClass = getClass(value);
                section.classList.remove(...allClasses);
                section.classList.add(sectionClass);
            });

            // Gestion des éléments manquants
            if (missingItems.length > 0) {
                document.getElementById("missingItems").style.display = "block";
                document.getElementById("missingList").innerHTML = missingItems.map(item =>
                    "<div class=\"missing-item\">• " + item + "</div>"
                ).join("");
            } else {
                document.getElementById("missingItems").style.display = "none";
            }
        }
        
        // Fonctions de gestion des commentaires
        function toggleComment(criteriaId) {
            const commentSection = document.getElementById('comment-section-' + criteriaId);
            const isShowing = commentSection.classList.contains('show');
            
            if (isShowing) {
                commentSection.classList.remove('show');
            } else {
                commentSection.classList.add('show');
                // Focus sur le textarea
                setTimeout(() => {
                    document.getElementById('comment-' + criteriaId).focus();
                }, 100);
            }
        }
        
        function updateCommentButton(criteriaId) {
            const textarea = document.getElementById('comment-' + criteriaId);
            const button = document.querySelector('[onclick="toggleComment(\'' + criteriaId + '\')"]');
            const commentSection = document.getElementById('comment-section-' + criteriaId);
            
            if (textarea.value.trim() !== '') {
                button.classList.add('has-content');
                button.title = 'Commentaire ajouté - Cliquer pour modifier';
                commentSection.classList.add('has-content');
            } else {
                button.classList.remove('has-content');
                button.title = 'Ajouter un commentaire';
                commentSection.classList.remove('has-content');
            }
        }
        
        function toggleSectionComment(sectionName) {
            const section = document.getElementById('section-comment-' + sectionName);
            const button = document.querySelector('[onclick="toggleSectionComment(\'' + sectionName + '\')"]');
            const isShowing = section.classList.contains('show');
            
            if (isShowing) {
                section.classList.remove('show');
            } else {
                section.classList.add('show');
                // Focus sur le textarea
                setTimeout(() => {
                    document.getElementById('comment-section-' + sectionName).focus();
                }, 100);
            }
        }
        
        function updateSectionComment(sectionName) {
            const textarea = document.getElementById('comment-section-' + sectionName);
            const section = document.getElementById('section-comment-' + sectionName);
            const button = document.querySelector('[onclick="toggleSectionComment(\'' + sectionName + '\')"]');
            
            if (textarea.value.trim() === '') {
                section.classList.remove('has-content');
                if (section.classList.contains('global')) {
                    section.classList.add('empty');
                }
                if (button) {
                    button.classList.remove('has-content');
                    button.title = 'Commentaire sur cette section';
                }
            } else {
                section.classList.add('has-content');
                section.classList.remove('empty');
                if (button) {
                    button.classList.add('has-content');
                    button.title = 'Commentaire ajouté - Cliquer pour modifier';
                }
            }
        }
        
        // Fonction spécifique pour le commentaire général
        function updateGeneralComment() {
            const textarea = document.getElementById('comment-general');
            const section = document.getElementById('section-comment-general');
            
            if (textarea.value.trim() === '') {
                section.classList.remove('has-content');
            } else {
                section.classList.add('has-content');
            }
        }
        
        // Préparer l'impression en masquant les sections vides
        function prepareForPrint() {
            // Marquer les sections de critères sans contenu comme show=false pour l'impression
            document.querySelectorAll('.criterion-comment-section').forEach(section => {
                const textarea = section.querySelector('.comment-textarea');
                if (!textarea || textarea.value.trim() === '') {
                    section.classList.remove('show');
                }
            });
            
            // Marquer les sections vides
            ['anamnese', 'examen', 'management', 'communication', 'general'].forEach(sectionName => {
                const textarea = document.getElementById('comment-section-' + sectionName);
                const section = document.getElementById('section-comment-' + sectionName);
                if (textarea && textarea.value.trim() === '') {
                    section.classList.add('empty');
                } else if (section) {
                    section.classList.remove('empty');
                }
            });
        }
        
        // Écouter l'événement d'impression
        window.addEventListener('beforeprint', prepareForPrint);

        // Initialisation
        calculateScores();
        
        // Initialiser la section globale comme vide
        const globalSection = document.getElementById('section-comment-general');
        if (globalSection) {
            globalSection.classList.add('empty');
        }
    </script>
</body>
</html>